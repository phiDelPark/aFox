!function(e){"use strict";e("#ledger_write_modal").on("show.bs.modal",(function(t){var i=e(this),a=i.find("form"),n=i.find(".modal-body"),d=e(t.relatedTarget).attr("data-ledger-srl");i.find(".modal-title").html(d?$_LANG.edit:$_LANG.new);var r=function(e,t,i){if("success"==e)return location.reload(),!1;"error"==e&&alert(t.message)},l=function(e,t){var i=n.find("#id-ev-items"),a=n.find("#ledger-item-panel");i.attr("data-item-index","-1"),i.attr("data-item-amount","0"),a.css("margin","0px"),a.css("padding","15px"),a.height(i.height()-24),a.find("[id=ev_item_caption]").val(""),a.find("[id=ev_item_count]").val("1"),a.find("[id=ev_item_unit]").val(""),a.find("[id=ev_item_price]").val("0"),a.find("[id=ev_item_tax]").val("0"),a.find("[id=ev_item_info]").val("")},m=function(e,t){l();var i=n.find("#id-ev-items"),a=n.find("#ledger-item-panel"),d=decodeURIComponent(t),r=JSON.parse(d.nl2br("\\\\n"));a.find("[id=ev_item_caption]").val(r.caption),a.find("[id=ev_item_count]").val(r.count),a.find("[id=ev_item_unit]").val(r.unit),a.find("[id=ev_item_price]").val(r.price),a.find("[id=ev_item_tax]").val(r.tax),a.find("[id=ev_item_info]").val(r.info.unescapeHtml().replace(/\\n/g,"\n")),a.find("#itemdelete").show(),i.attr("data-item-index",e),i.attr("data-item-amount",(Number(r.price)+Number(r.tax))*Number(r.count)),a.show()};a.attr("data-exec-ajax","ledger.getdocumentform").find("input[name=ev_srl]").val(d).end().find("#delete-ledger-document").click((function(){t.preventDefault();var i={},n=(e(this),a.find("input[name=ev_srl]").val());i.ev_srl=n,exec_ajax("ledger.deleteDocument",i,r)})).end().offOn("error.exec.ajax",(function(e,t,i){e.preventDefault(),n.html('<div class="alert alert-danger">'+t.message+"</div>")})).offOn("success.exec.ajax",(function(t,i,a){if(t.preventDefault(),"ledger.updatedocument"==e(t.target).attr("data-exec-ajax")&&i.redirect_url)parent.location.replace(i.redirect_url);else if(e(t.target).attr("data-exec-ajax","ledger.updatedocument"),void 0!==i.tpl){n.html(i.tpl);var d=n.find("#id-ev-items"),r=n.find("#ledger-item-panel");n.find("[data-toggle=ledger-item-form]").click((function(e){e.preventDefault(),l(),n.find("#itemdelete").hide(),r.show()})),r.find("#itemclose").click((function(e){e.preventDefault(),r.hide()})),n.find("#iteminsert").click((function(t){t.preventDefault();var i=n.find("[id=ev_item_caption]").val().trim(),a=Number(d.attr("data-item-amount")),l=Number(n.find("[id=ev_item_price]").val()),o=Number(n.find("[id=ev_item_tax]").val()),f=Number(n.find("[id=ev_item_count]").val()),v=n.find("[id=ev_item_unit]").val(),c=n.find("[id=ev_item_info]").val().trim().replace(/\\/g,"/").escapeHtml(),u='{"caption":"'+i+'",';if(u=(u=(u=(u=u+'"count":"'+f+'",')+'"unit":"'+v+'",')+'"price":"'+l+'",')+'"tax":"'+o+'",',u=encodeURIComponent((u+'"info":"'+c+'"}').nl2br("\\\\n")),i){var s=d.attr("data-item-index"),_=n.find("[name=ev_amount]");if(i="<div>"+i+'</div><div class="right">'+(l+o)*f+"</div>",s>-1)d.find("li").eq(s).html(i),d.find("li").eq(s).attr("data-value",u);else{var p=e('<li data-value="'+u+'">'+i+"</li>");p.dblclick((function(t){return t.preventDefault(),m(e(this).index(),e(this).attr("data-value")),!1})),d.append(p)}_.val(Number(_.val())-a+(l+o)*f),r.hide()}else alert($_LANG.request_item_name),n.find("[id=ev_item_caption]").focus()})),n.find("#itemdelete").click((function(e){e.preventDefault();var t=Number(d.attr("data-item-amount")),i=d.attr("data-item-index"),a=n.find("[name=ev_amount]");i>-1&&(d.find("li").eq(i).remove(),a.val(Number(a.val())-t)),r.hide()})),d.find("li").dblclick((function(t){return t.preventDefault(),m(e(this).index(),e(this).attr("data-value")),!1}))}})),a.submit((function(){var t="";e(this).find("#id-ev-items li[data-value]").each((function(){t=t+","+e(this).attr("data-value")})),e(this).find("[name=ev_items]").val(t.substring(1))})),e(document).trigger(e.Event("submit",{target:a[0]}))})).on("shown.bs.modal",(function(){var t=e(this);t.find("#id-ev-items").height(t.find("#ledger-form").height()-t.find("#ledger-item-form .form-group").eq(0).height()-42)})).on("hidden.bs.modal",(function(){e(this).find(".modal-body").html("")})),e(".breadcrumb select").change((function(){window.location=e(this).val()})),e.datepicker.setDefaults({dateFormat:"yy년 mm월 dd일",prevText:"이전 달",nextText:"다음 달",monthNames:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],monthNamesShort:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayNames:["일","월","화","수","목","금","토"],dayNamesShort:["일","월","화","수","목","금","토"],dayNamesMin:["일","월","화","수","목","금","토"],showMonthAfterYear:!0,yearSuffix:"년"}),e(window).on("load",(function(){}))}(jQuery);