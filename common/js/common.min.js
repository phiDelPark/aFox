if("undefined"==typeof jQuery)throw document.getElementById("def-jQuery-JS")||parent.location.replace(request_uri+"?cdnerr=jquery"),new Error("aFox's JavaScript requires jQuery");if(void 0===$("body").alert)throw document.getElementById("def-Bootstrap-JS")||parent.location.replace(request_uri+"?cdnerr=bootstrap"),new Error("aFox's JavaScript requires Bootstrap");var $_LANG={};!function(e){"use strict";String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toUcFirst=function(){var e=this.toLowerCase();return e.charAt(0).toUpperCase()+e.slice(1)},String.prototype.sprintf=function(){for(var e=this,t=0,a=arguments.length;t<a;t++)e=e.replace(/%(s|d)/,arguments[t]);return e},String.prototype.stripTags=function(e){e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var t=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,a=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return this.replace(a,"").replace(t,function(t,a){return e.indexOf("<"+a.toLowerCase()+">")>-1?t:""})},String.prototype.escapeMKDW=function(e){var t=!1===e?/[\`\[\]]/g:/[\\\`\*\_\{\}\[\]\(\)\>\#\+\-\.\!]/g;return this.replace(t,function(e){return"\\"+e})},String.prototype.escapeHtml=function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(t){return e[t]})},String.prototype.getQuery=function(e){var t={};return decodeURIComponent(this).replace(/&amp;/g,"&").replace(/[?&]+([^=&]+)=([^&]*)/g,function(e,a,i){t[a]=i}),e?t[e]||"":t},String.prototype.setQuery=function(){var e=decodeURIComponent(this).replace(/&amp;/g,"&"),t=arguments,a=t.length;if(0===a)return e;"object"==typeof t[0]&&(a=(t=t[0]).length);for(var i,r=""!==t[0]?e.getQuery():{},n=[],o=""===t[0]?1:0;o<a;o+=2)r[t[o]]=t[o+1];for(var s in r)r.hasOwnProperty(s)&&(i=String(r[s]).trim())&&n.push(s+"="+i);var d=e.indexOf("?");return"/"!=(e=-1==d?e:e.substr(0,d)).substr(-1,1)&&(e+="/"),e+(n.length>0?"?"+n.join("&"):"")},Number.prototype.shortFileSize=function(){for(var e=this,t=["B","KB","MB","GB"],a=0;a<4&&!(e<=1024);a++)e/=1024;return e.toFixed(1)+t[a]},HTMLFormElement.prototype.dataExport=function(){var t,a,i={},r=e(this).serializeArray();for(var n in r){if(t=r[n].name,a=r[n].value,"[]"===t.substring(t.length-2)){var o=e('[name="'+t+'"]');(o.eq(0).is(":checkbox")||o.eq(0).is(":radio"))&&(a=(o=e('[name="'+t+'"]:checked')).map(function(){return this.value}).get(),t=t.slice(0,-2))}i[t]=a}return i},HTMLFormElement.prototype.dataImport=function(t){var a,i,r;for(var n in t)if(r="",(a=e(this).find("[name="+n+"]")).is("input"))if(a.is(":file")){if((i=a.parent().parent().parent()).hasClass("uploader-group")){if(i.find("input:file").val(""),t[n])if(e.isArray(t[n])){i.addClass("file-list").find("input:file").attr("multiple","1");for(var o in t[n])r+='<i class="file-item" title="'+o.title+'" data-type="'+o.type+'"></i>'}else r='<i class="file-item">'+t[n]+"</i>";i.find(".file-caption").html(r||(i.attr("placeholder")||""))}}else if(a.is(":checkbox"))1==t[n]?a.attr("checked","checked"):a.removeAttr("checked");else if(a.is(":radio"))a.filter(function(){return this.value===t[n]}).attr("checked","checked");else if("hidden"==a.attr("type")){if(a.val(t[n]),(i=a.parent()).hasClass("radio-group"))i.find(".radio").removeClass("active"),i.find('.radio[data-value="'+t[n]+'"]').addClass("active");else if(i.hasClass("switch-group")){var s=i.find(".switch-handle-on").attr("data-value")||1;t[n]==s?i.addClass("on"):i.removeClass("on")}}else a.val("0"==t[n]?"":t[n]);else(a.is("select")||a.is("textarea"))&&a.val(t[n]);var d=e(this).find(".af-editor-group");if(d.length>0){d.find(".af-editor-toolbar input:hidden").each(function(){var t=e(this),a=t.closest(".af-editor-toolbar"),i=t.attr("name"),r=t.val();a.find('[data-target="'+i+'"]').find(".glyphicon").addClass("glyphicon-unchecked").removeClass("glyphicon-check"),a.find('[data-target="'+i+'"][data-value="'+r+'"]').find(".glyphicon").addClass("glyphicon-check").removeClass("glyphicon-unchecked")});var l=d.find('[name="upload_files[]"]');l.length>0&&e.isArray(t.files)&&t.files.length>0&&(r='<div class="form-group has-feedback" style="margin-bottom:5px"><div class="af-editor-uploaded uploader-group file-list form-control" style="margin-top:10px">',e.map(t.files,function(e,t){r+='<i class="file-item" draggable="true" title="'+e.mf_name.escapeHtml()+" ("+Number(e.mf_size).shortFileSize()+')" data-type="'+e.mf_type+'" data-srl="'+e.mf_srl+'"></i>'}),r+='</div><span class="glyphicon glyphicon-question-sign form-control-feedback" style="pointer-events:auto;cursor:pointer" tabindex="0"></span></div>',l.closest(".af-editor-uploader").prepend(r))}},e.msg_box=window.msg_box=function(t,a,i,r){var n='<div class="modal fade" id="afMessageBox" tabindex="-1" role="dialog" aria-labelledby="MessageBox" aria-hidden="true" style="z-index:99999"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><i class="glyphicon glyphicon-%s" aria-hidden="true"></i> %s</div><div class="modal-body"></div><div class="modal-footer">%s</div></div></div></div>',o={info:"info-sign",question:"question-sign",asterisk:"asterisk",warning:"exclamation-sign"},s={ok:$_LANG.ok||"Ok",cancel:$_LANG.cancel||"Cancel",yes:$_LANG.yes||"Yes",no:$_LANG.no||"No"},d='<button type="button" class="btn btn-default%s" data-key="%s">%s</button>',l=d.sprintf(' btn-primary" data-dismiss="modal',"ok",s.ok);if(a||(a=(e("title").text().split("-")||["Alert"])[0]),i&&i[1]){l="";for(var c in i[1]){var p=i[1][c].toLowerCase();l+=d.sprintf(p.toUpperCase()===i[1][c]?" btn-primary":"",p,s[p])}}n=n.sprintf(o[i?i[0]:"warning"],a,l);var u=e(n).find(".modal-body:eq(0)").html(t).end();return u.prependTo("body").on("show.bs.modal",function(t){e.isFunction(r)&&r("show",u.find(".modal-body"))}).on("hide.bs.modal",function(t){e.isFunction(r)&&r("hide",u.find(".modal-body"))}).on("shown.bs.modal",function(t){e(this).find('.modal-body input[type!="hidden"]:eq(0)').focus()}).on("hidden.bs.modal",function(t){e(this).remove()}).on("keydown",function(t){13==t.which&&"TEXTAREA"!=t.target.tagName&&(t.preventDefault(),e(this).find(".modal-footer>button.btn-primary").click())}).modal("show").find(".modal-footer>button").on("click",function(t){if(e.isFunction(r)){if(!r(e(this).attr("data-key"),u.find(".modal-body")))return!1;u.modal("hide")}}),!1},e.pop_win=window.pop_win=function(e,t,a,i){var r=window.open(e,i||"af_popup","width="+(t||"700")+",height="+(a||"500")+",top=50,left=50,scrollbars=yes,toolbar=no,menubar=no,location=no");return r.focus(),r},e.exec_ajax=window.exec_ajax=function(t,a,i,r){var n=e("string"==typeof t?"BODY":t),o=(("string"==typeof t?t:n.attr("data-exec-ajax"))||"").split(".");if(2==o.length&&!n.data("actioning")){n.data("actioning",!0);var s="FORM"==t.tagName,d="multipart/form-data"==(n.attr("enctype")||""),l=a||{},c=e('<div class="af_waiting_message alert alert-warning" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> '+($_LANG&&$_LANG.calling_server?$_LANG.calling_server:"Please wait...")+'<div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" style="width:100%"></div></div></div>');if(c.hide().appendTo("body").fadeIn(1500),(void 0===r||r.length<1)&&(r=[]),s&&d)(l=new FormData(n[0])).append("module",o[0]),l.append("act",o[1]),l.append("response_tags",r);else{if(s)l=n[0].dataExport();else{var p=(n.attr("data-ajax-param")||"").split(",");if(p.length>1)for(var u=0,f=p.length;u<f;u+=2)l[p[u]]=p[u+1]}e.extend(l,{module:o[0],act:o[1],response_tags:r}),l=JSON.stringify(l)}try{e.ajax({type:"POST",url:request_uri,dataType:!d&&"json",contentType:!d&&"application/json",processData:!d,data:l,beforeSend:function(t,a){var r=!1;if(e.isFunction(i))r=!1===i("before",a,t);else{var o=e.Event("before.exec.ajax");n.trigger(o,[a,t]),r=o.isDefaultPrevented()}if(r)return c.remove(),n.data("actioning",!1),!1},complete:function(t,a){e.isFunction(i)?i("complete",a,t):n.trigger("complete.exec.ajax",[a,t]),c.remove(),n.data("actioning",!1)},success:function(t,a,r){var o,s,d,l=!1;if("string"==typeof t?(s=-1,d=r.responseText.replace(/<[^>]+>/g,"")):d=(s=t.error&&"0"!=t.error?t.error:0)?t.message:"",e.isFunction(i)?l=!1===i(s?"error":"success",s?d:t,r):(o=e.Event(s?"error.exec.ajax":"success.exec.ajax"),n.trigger(o,s?[d,r]:[t,r]),l=o.isDefaultPrevented()),l)return c.remove(),void n.data("actioning",!1);s&&alert(d.replace(/<br[\s|\/]*>/g,"\n")),t.redirect_url&&parent.location.replace(t.redirect_url)},error:function(t,a,r){var o=a,s=!1;if("parsererror"==a?(o="The result is not valid JSON :\n--------------------------------\n",""!==t.responseText&&(o+=t.responseText.replace(/<[^>]+>/g,"")),console.log(o),o="parsererror"):o=r,e.isFunction(i))s=!1===i("error",o,t);else{var d=e.Event("error.exec.ajax");n.trigger(d,[o,t]),s=d.isDefaultPrevented()}if(s)return c.remove(),void n.data("actioning",!1);alert(o.replace(/<br[\s|\/]*>/g,"\n")),l.redirect_url&&parent.location.replace(l.redirect_url)}})}catch(e){alert(e),c.remove(),n.data("actioning",!1)}}},e(document).on("submit","form[data-exec-ajax]",function(e){return e.preventDefault(),exec_ajax(this),!1}).on("click","[data-exec-ajax][data-ajax-param]",function(t){var a=e(t.target);return!!a.is("[except-event]")||(void 0!==a.data("clicked")&&!0!==a.data("clicked")||(t.preventDefault(),exec_ajax(this)),!1)}),e(document).on("change",".uploader-group input:file",function(t){var a=e(this),i=a.closest(".uploader-group"),r=i.find(".file-caption"),n=a[0].hasAttribute("multiple");n&&i.addClass("file-list");var o=e.Event("insert.af.uploader");i.trigger(o,[a.prop("files")]),o.isDefaultPrevented()||(r.html(""),e.map(a.prop("files"),function(t,a){var i=(t.type.split("/")[0]||"binary").escapeHtml(),o=t.size.shortFileSize(),s=t.name.escapeHtml()+" ("+o+")";e('<i class="file-item" title="'+(n?s:"")+'" data-type="'+i+'" data-index="'+a+'">').html(n?"":s).appendTo(r)}))}).on("click",".uploader-group .file-caption",function(t){var a=e(this),i=a.find(".file-item"),r=a.closest(".uploader-group"),n=r.find("input:file"),o=r.attr("placeholder")||"";if(i.length>0){var s=e.Event("delete.af.uploader");if(r.trigger(s,[n.prop("files")]),s.isDefaultPrevented())return;n.val(""),e('<input type="hidden" name="remove_files[]" value="'+n.attr("name")+'">').appendTo(a.text(o))}}).on("keydown",".uploader-group .file-caption",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).click())}).on("keydown",".uploader-group .btn-file",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).find("input:file").click())}).on("uploader:repair",".uploader-group",function(t){var a=e(this),i=a.find("input:hidden"),r=a.find(".file-caption"),n=a.attr("placeholder")||"";!r.find(".file-item").length&&n&&r.text(n),r[0]&&!r[0].hasAttribute("tabindex")&&r.attr("tabindex","0"),i[0]&&!i[0].hasAttribute("tabindex")&&(i.parent().attr("tabindex","0"),i.attr("tabindex","-1"))}),e(document).on("click",".radio-control",function(t){var a=e(t.target),i=a.closest(".radio-group");if(!a[0].hasAttribute("readonly")&&!a[0].hasAttribute("disabled")&&a.hasClass("radio")){var r=a.attr("data-value")||"0";i.find("input:hidden").val(r).end().find(".radio").removeClass("active"),a.addClass("active"),i.trigger("changed.af.radio",[r])}}).on("keydown",".radio-control .radio",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).click())}).on("radio:repair",".radio-group",function(t){var a=e(this),i=a.find("input:hidden").val();a.find(".radio").each(function(){e(this).removeClass("active"),this.hasAttribute("tabindex")||e(this).attr("tabindex","0")}),a.find('.radio[data-value="'+i+'"]').addClass("active")}),e(document).on("click",".switch-group",function(t){var a=e(this);if(!a[0].hasAttribute("readonly")&&!a[0].hasAttribute("disabled")&&!a.data("actioning")){a.data("actioning",!0);var i=a.hasClass("on"),r=a.find(".switch-handle-on").attr("data-value")||1,n=a.find(".switch-handle-off").attr("data-value")||0,o=e.Event("change.af.switch");a.trigger(o,[i,i?r:n]),o.isDefaultPrevented()?a.data("actioning",!1):a.find(".switch-control").animate({left:i?"-=100":"+=100"},500,function(){e(this).css("left",""),a.toggleClass("on").find("input:hidden").val(i?n:r).end().trigger("changed.af.switch",[!i,i?n:r]).data("actioning",!1)})}}).on("keydown",".switch-group",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).click())}).on("switch:repair",".switch-group",function(t){var a=e(this),i=a.find("input:hidden"),r=a.find(".switch-handle-on").attr("data-value")||1;a.removeClass("on").addClass((i.val()||0)==r?"on":""),a[0].hasAttribute("tabindex")||a.attr("tabindex","0")}),e(document).on("keyup","input[maxbyte],textarea[maxbyte]",function(t){var a=e(this),i=a.attr("maxbyte")||0;if(!isNaN(i)){for(var r,n=0,o="",s=a.val(),d=0;!isNaN(r=s.charCodeAt(d))&&!((n+=r<128?1:r<2048?2:r<3936256?3:4)>i);d++)o+=String.fromCharCode(r);a.val(o)}}),e(window).on("load",function(){e(".radio-group").trigger("radio:repair"),e(".switch-group").trigger("switch:repair"),e(".uploader-group").trigger("uploader:repair")})}(jQuery);