if("undefined"==typeof jQuery)throw document.getElementById("def-jQuery-JS")||parent.location.replace(request_uri+"?cdnerr=jquery"),new Error("aFox's JavaScript requires jQuery");if(void 0===$("body").alert)throw document.getElementById("def-Bootstrap-JS")||parent.location.replace(request_uri+"?cdnerr=bootstrap"),new Error("aFox's JavaScript requires Bootstrap");var $_LANG=[];!function(a){"use strict";String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toUcFirst=function(){var a=this.toLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)},String.prototype.sprintf=function(){for(var a=this,b=0,c=arguments.length;b<c;b++)a=a.replace(/%(s|d)/,arguments[b]);return a},String.prototype.stripTags=function(a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return this.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,c){return a.indexOf("<"+c.toLowerCase()+">")>-1?b:""})},String.prototype.escapeMKDW=function(a){var b=!1===a?/[\`\[\]]/g:/[\\\`\*\_\{\}\[\]\(\)\>\#\+\-\.\!]/g;return this.replace(b,function(a){return"\\"+a})},String.prototype.escapeHtml=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(b){return a[b]})},String.prototype.getQuery=function(a){var b=decodeURIComponent(this).replace(/&amp;/g,"&"),c={};return b.replace(/[?&]+([^=&]+)=([^&]*)/g,function(a,b,d){c[b]=d}),a?c[a]||"":c},String.prototype.setQuery=function(){var a=decodeURIComponent(this).replace(/&amp;/g,"&"),b=arguments,c=b.length;if(0===c)return a;"object"==typeof b[0]&&(b=b[0],c=b.length);for(var d,e=""!==b[0]?a.getQuery():{},f=[],g=""===b[0]?1:0;g<c;g+=2)e[b[g]]=b[g+1];for(var h in e)e.hasOwnProperty(h)&&(d=String(e[h]).trim())&&f.push(h+"="+d);var i=a.indexOf("?");return a=-1==i?a:a.substr(0,i),"/"!=a.substr(-1,1)&&(a+="/"),a+(f.length>0?"?"+f.join("&"):"")},Number.prototype.shortFileSize=function(){for(var a=this,b=["Byte","KB","MB","GB"],c=0;c<4&&!(a<=1024);c++)a/=1024;return a.toFixed(1)+b[c]},HTMLFormElement.prototype.dataExport=function(){var b,c,d={},e=a(this).serializeArray();for(var f in e){if(b=e[f].name,c=e[f].value,"[]"===b.substring(b.length-2)){var g=a('[name="'+b+'"]');(g.eq(0).is(":checkbox")||g.eq(0).is(":radio"))&&(g=a('[name="'+b+'"]:checked'),c=g.map(function(){return this.value}).get(),b=b.slice(0,-2))}d[b]=c}return d},HTMLFormElement.prototype.dataImport=function(b){var c,d,e;for(var f in b)if(e="",c=a(this).find("[name="+f+"]"),c.is("input"))if(c.is(":file")){if(d=c.parent().parent().parent(),d.hasClass("fileupload-group")){if(d.find("input:file").val(""),b[f])if(a.isArray(b[f])){d.addClass("file-list").find("input:file").attr("multiple","1");for(var g in b[f])e+='<i class="file-item" title="'+g.title+'" data-type="'+g.type+'"></i>'}else e='<i class="file-item">'+b[f]+"</i>";d.find(".file-caption").html(e||(d.attr("placeholder")||""))}}else if(c.is(":checkbox"))1==b[f]?c.attr("checked","checked"):c.removeAttr("checked");else if(c.is(":radio"))c.filter(function(){return this.value===b[f]}).attr("checked","checked");else if("hidden"==c.attr("type")){if(c.val(b[f]),d=c.parent(),d.hasClass("radio-group"))d.find(".radio").removeClass("active"),d.find('.radio[data-value="'+b[f]+'"]').addClass("active");else if(d.hasClass("switch-group")){var h=d.find(".switch-handle-on").attr("data-value")||1;b[f]==h?d.addClass("on"):d.removeClass("on")}}else c.val("0"==b[f]?"":b[f]);else(c.is("select")||c.is("textarea"))&&c.val(b[f]);var i=a(this).find(".af-editor-group");if(i.length>0){i.find(".af-editor-toolbar input:hidden").each(function(){var b=a(this),c=b.closest(".af-editor-toolbar"),d=b.attr("name"),e=b.val();c.find('[data-target="'+d+'"]').find(".glyphicon").addClass("glyphicon-unchecked").removeClass("glyphicon-check"),c.find('[data-target="'+d+'"][data-value="'+e+'"]').find(".glyphicon").addClass("glyphicon-check").removeClass("glyphicon-unchecked")});var j=i.find('[name="upload_files[]"]');j.length>0&&a.isArray(b.files)&&b.files.length>0&&(e='<div class="form-group has-feedback" style="margin-bottom:5px"><div class="af-editor-uploaded-list fileupload-group file-list form-control" style="margin-top:10px">',a.map(b.files,function(a,b){e+='<i class="file-item" draggable="true" title="'+a.mf_name.escapeHtml()+" ("+Number(a.mf_size).shortFileSize()+')" data-type="'+a.mf_type+'" data-srl="'+a.mf_srl+'"></i>'}),e+='</div><span class="glyphicon glyphicon-question-sign form-control-feedback" style="pointer-events:auto;cursor:pointer" tabindex="0"></span></div>',j.closest(".af-editor-upload-button").prepend(e))}},a.pop_win=window.pop_win=function(a,b,c,d){var e=window.open(a,d||"af_popup","width="+(b||"700")+",height="+(c||"500")+",top=50,left=50,scrollbars=yes,toolbar=no,menubar=no,location=no");return e.focus(),e},a.exec_ajax=window.exec_ajax=function(b,c,d,e){var f=a("string"==typeof b?"BODY":b),g=(("string"==typeof b?b:f.attr("data-exec-ajax"))||"").split(".");if(2==g.length&&!f.data("actioning")){f.data("actioning",!0);var h="FORM"==b.tagName,i="multipart/form-data"==(f.attr("enctype")||""),j=c||{};waiting_message||(waiting_message="");var k=a('<div class="af_waiting_message alert alert-warning" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> '+waiting_message+'<div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" style="width:100%"></div></div></div>');if(k.hide().appendTo("body").fadeIn(1500),(void 0===e||e.length<1)&&(e=[]),h&&i)j=new FormData(f[0]),j.append("module",g[0]),j.append("act",g[1]),j.append("response_tags",e);else{if(h)j=f[0].dataExport();else{var l=(f.attr("data-ajax-param")||"").split(",");if(l.length>1)for(var m=0,n=l.length;m<n;m+=2)j[l[m]]=l[m+1]}a.extend(j,{module:g[0],act:g[1],response_tags:e}),j=JSON.stringify(j)}try{a.ajax({type:"POST",url:request_uri,dataType:!i&&"json",contentType:!i&&"application/json",processData:!i,data:j,beforeSend:function(b,c){var e=!1;if(a.isFunction(d))e=!1===d("before",c,b);else{var g=a.Event("before.exec.ajax");f.trigger(g,[c,b]),e=g.isDefaultPrevented()}if(e)return k.remove(),f.data("actioning",!1),!1},complete:function(b,c){a.isFunction(d)?d("complete",c,b):f.trigger("complete.exec.ajax",[c,b]),k.remove(),f.data("actioning",!1)},success:function(b,c,e){var g,h,i,j=!1;if("string"==typeof b?(h=-1,i=e.responseText.replace(/<[^>]+>/g,"")):(h=b.error&&"0"!=b.error?b.error:0,i=h?b.message:""),a.isFunction(d)?j=!1===d(h?"error":"success",h?i:b,e):(g=a.Event(h?"error.exec.ajax":"success.exec.ajax"),f.trigger(g,h?[i,e]:[b,e]),j=g.isDefaultPrevented()),j)return k.remove(),void f.data("actioning",!1);h&&alert(i.replace(/<br[\s|\/]*>/g,"\n")),b.redirect_url&&parent.location.replace(b.redirect_url)},error:function(b,c,e){var g=c,h=!1;if("parsererror"==c?(g="The result is not valid JSON :\n--------------------------------\n",""!==b.responseText&&(g+=b.responseText.replace(/<[^>]+>/g,"")),console.log(g),g="parsererror"):g=e,a.isFunction(d))h=!1===d("error",g,b);else{var i=a.Event("error.exec.ajax");f.trigger(i,[g,b]),h=i.isDefaultPrevented()}if(h)return k.remove(),void f.data("actioning",!1);alert(g.replace(/<br[\s|\/]*>/g,"\n")),j.redirect_url&&parent.location.replace(j.redirect_url)}})}catch(a){alert(a),k.remove(),f.data("actioning",!1)}}},a(document).on("submit","form[data-exec-ajax]",function(a){a.preventDefault(),exec_ajax(this)}).on("click","[data-exec-ajax][data-ajax-param]",function(a){a.preventDefault(),exec_ajax(this)}),a(document).on("change",".fileupload-group input:file",function(b){var c=a(this),d=c.closest(".fileupload-group"),e=d.find(".file-caption"),f=c[0].hasAttribute("multiple");f&&d.addClass("file-list");var g=a.Event("insert.af.fileupload");d.trigger(g,[c.prop("files")]),g.isDefaultPrevented()||(e.html(""),a.map(c.prop("files"),function(b,c){var d=(b.type.split("/")[0]||"binary").escapeHtml(),g=b.size.shortFileSize(),h=b.name.escapeHtml()+" ("+g+")";a('<i class="file-item" title="'+(f?h:"")+'" data-type="'+d+'" data-index="'+c+'">').html(f?"":h).appendTo(e)}))}).on("click",".fileupload-group .file-caption",function(b){var c=a(this),d=c.find(".file-item"),e=c.closest(".fileupload-group"),f=e.find("input:file"),g=e.attr("placeholder")||"";if(d.length>0){var h=a.Event("delete.af.fileupload");if(e.trigger(h,[f.prop("files")]),h.isDefaultPrevented())return;f.val(""),a('<input type="hidden" name="remove_files[]" value="'+f.attr("name")+'">').appendTo(c.text(g))}}).on("keydown",".fileupload-group .file-caption",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}).on("keydown",".fileupload-group .btn-file",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).find("input:file").click())}).on("fileupload:repair",".fileupload-group",function(b){var c=a(this),d=c.find("input:hidden"),e=c.find(".file-caption"),f=c.attr("placeholder")||"";!e.find(".file-item").length&&f&&e.text(f),e[0]&&!e[0].hasAttribute("tabindex")&&e.attr("tabindex","0"),d[0]&&!d[0].hasAttribute("tabindex")&&(d.parent().attr("tabindex","0"),d.attr("tabindex","-1"))}),a(document).on("click",".radio-control",function(b){var c=a(b.target),d=c.closest(".radio-group");if(!c[0].hasAttribute("readonly")&&!c[0].hasAttribute("disabled")&&c.hasClass("radio")){var e=c.attr("data-value")||"0";d.find("input:hidden").val(e).end().find(".radio").removeClass("active"),c.addClass("active"),d.trigger("changed.af.radio",[e])}}).on("keydown",".radio-control .radio",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}).on("radio:repair",".radio-group",function(b){var c=a(this),d=c.find("input:hidden"),e=d.val();c.find(".radio").each(function(){a(this).removeClass("active"),this.hasAttribute("tabindex")||a(this).attr("tabindex","0")}),c.find('.radio[data-value="'+e+'"]').addClass("active")}),a(document).on("click",".switch-group",function(b){var c=a(this);if(!c[0].hasAttribute("readonly")&&!c[0].hasAttribute("disabled")&&!c.data("actioning")){c.data("actioning",!0);var d=c.hasClass("on"),e=c.find(".switch-handle-on").attr("data-value")||1,f=c.find(".switch-handle-off").attr("data-value")||0,g=a.Event("change.af.switch");if(c.trigger(g,[d,d?e:f]),g.isDefaultPrevented())return void c.data("actioning",!1);c.find(".switch-control").animate({left:d?"-=100":"+=100"},500,function(){a(this).css("left",""),c.toggleClass("on").find("input:hidden").val(d?f:e).end().trigger("changed.af.switch",[!d,d?f:e]).data("actioning",!1)})}}).on("keydown",".switch-group",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}).on("switch:repair",".switch-group",function(b){var c=a(this),d=c.find("input:hidden"),e=c.find(".switch-handle-on").attr("data-value")||1;c.removeClass("on").addClass((d.val()||0)==e?"on":""),c[0].hasAttribute("tabindex")||c.attr("tabindex","0")}),a(document).on("keyup","input[maxbyte],textarea[maxbyte]",function(b){var c=a(this),d=c.attr("maxbyte")||0;if(!isNaN(d)){for(var e,f=0,g="",h=c.val(),i=0;!isNaN(e=h.charCodeAt(i))&&!((f+=e<128?1:e<2048?2:e<3936256?3:4)>d);i++)g+=String.fromCharCode(e);c.val(g)}}),a(window).on("load",function(){a(".radio-group").trigger("radio:repair"),a(".switch-group").trigger("switch:repair"),a(".fileupload-group").trigger("fileupload:repair")})}(jQuery);