if("undefined"==typeof jQuery)throw document.getElementById("def-jQuery-JS")||parent.location.replace(request_uri+"?cdnerr=jquery"),new Error("aFox's JavaScript requires jQuery");if(void 0===$("body").alert)throw document.getElementById("def-Bootstrap-JS")||parent.location.replace(request_uri+"?cdnerr=bootstrap"),new Error("aFox's JavaScript requires Bootstrap");var $_LANG=[];!function(a){"use strict";String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toUcFirst=function(){var a=this.toLowerCase();return a.charAt(0).toUpperCase()+a.slice(1)},String.prototype.sprintf=function(){for(var a=this,b=0,c=arguments.length;b<c;b++)a=a.replace(/%(s|d)/,arguments[b]);return a},String.prototype.stripTags=function(a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return this.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,c){return a.indexOf("<"+c.toLowerCase()+">")>-1?b:""})},String.prototype.escapeMKDW=function(a){var b=!1===a?/[\`\[\]]/g:/[\\\`\*\_\{\}\[\]\(\)\>\#\+\-\.\!]/g;return this.replace(b,function(a){return"\\"+a})},String.prototype.escapeHtml=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(b){return a[b]})},String.prototype.setQuery=function(){var a=this,b=arguments,c=b.length;if(0===c)return a;var d,e=a.indexOf("?"),f=a.replace(/#$/,""),g={},h=[];-1!=e&&""!==b[0]&&f.substr(e+1,a.length).replace(/([^=]+)=([^&]*)(&|$)/g,function(a,b,c){g[b]=c}),f=a.substr(0,e);for(var i=""===b[0]?1:0;i<c;i+=2)g[b[i]]=b[i+1];for(var j in g)g.hasOwnProperty(j)&&(d=String(g[j]).trim())&&h.push(j+"="+decodeURI(d));return f+(h.length>0?"?"+h.join("&"):"")},Number.prototype.shortFileSize=function(){var a=this,b="byte";return a>1024&&(a=Math.ceil(a/1024),b="kb"),a>1024&&(a=Math.ceil(a/1024),b="mb"),a>1024&&(a=Math.ceil(a/1024),b="gb"),a+b},HTMLFormElement.prototype.dataExport=function(){var b,c,d={},e=a(this).serializeArray();for(var f in e){if(b=e[f].name,c=e[f].value,"[]"===b.substring(b.length-2)){var g=a('[name="'+b+'"]');(g.eq(0).is(":checkbox")||g.eq(0).is(":radio"))&&(g=a('[name="'+b+'"]:checked'),c=g.map(function(){return this.value}).get(),b=b.slice(0,-2))}d[b]=c}return d},HTMLFormElement.prototype.dataImport=function(b){var c,d,e;for(var f in b)if(e="",c=a(this).find("[name="+f+"]"),c.is("input"))if(c.is(":file")){if(d=c.parent().parent().parent(),d.hasClass("fileupload-group")){if(d.find("input:file").val(""),b[f])if(a.isArray(b[f])){d.addClass("file-list").find("input:file").attr("multiple","1");for(var g in b[f])e+='<i class="file-item" title="'+g.title+'" data-type="'+g.type+'"></i>'}else e='<i class="file-item">'+b[f]+"</i>";d.find(".file-caption").html(e||(d.attr("placeholder")||""))}}else if(c.is(":checkbox"))1==b[f]?c.attr("checked","checked"):c.removeAttr("checked");else if(c.is(":radio"))c.filter(function(){return this.value===b[f]}).attr("checked","checked");else if("hidden"==c.attr("type")){if(c.val(b[f]),d=c.parent(),d.hasClass("radio-group"))d.find(".radio").removeClass("active"),d.find('.radio[data-value="'+b[f]+'"]').addClass("active");else if(d.hasClass("switch-group")){var h=d.find(".switch-handle-on").attr("data-value")||1;b[f]==h?d.addClass("on"):d.removeClass("on")}}else c.val("0"==b[f]?"":b[f]);else(c.is("select")||c.is("textarea"))&&c.val(b[f]);var i=a(this).find(".af-editor-group");if(i.length>0){i.find(".af-editor-toolbar input:hidden").each(function(){var b=a(this),c=b.closest(".af-editor-toolbar"),d=b.attr("name"),e=b.val();c.find('[data-target="'+d+'"]').find(".glyphicon").addClass("glyphicon-unchecked").removeClass("glyphicon-check"),c.find('[data-target="'+d+'"][data-value="'+e+'"]').find(".glyphicon").addClass("glyphicon-check").removeClass("glyphicon-unchecked")});var j=i.find('[name="upload_files[]"]');j.length>0&&a.isArray(b.files)&&b.files.length>0&&(e='<div class="form-group has-feedback" style="margin-bottom:5px"><div class="af-editor-uploaded-list fileupload-group file-list form-control" style="margin-top:10px">',a.map(b.files,function(a,b){e+='<i class="file-item" draggable="true" title="'+a.mf_name.escapeHtml()+" ("+Number(a.mf_size).shortFileSize()+')" data-type="'+a.mf_type+'" data-srl="'+a.mf_srl+'"></i>'}),e+='</div><span class="glyphicon glyphicon-question-sign form-control-feedback" style="pointer-events:auto;cursor:pointer" tabindex="0"></span></div>',j.closest(".af-editor-upload-button").prepend(e))}},a.pop_win=window.pop_win=function(a,b,c,d){var e=window.open(a,d||"af_popup","width="+(b||"700")+",height="+(c||"500")+",top=50,left=50,scrollbars=yes,toolbar=no,menubar=no,location=no");return e.focus(),e},a.exec_ajax=window.exec_ajax=function(b,c,d){var e=a("string"==typeof b?"BODY":b),f=(("string"==typeof b?b:e.attr("data-exec-ajax"))||"").split(".");if(2==f.length&&!e.data("actioning")){e.data("actioning",!0);var g="FORM"==b.tagName,h="multipart/form-data"==(e.attr("enctype")||""),i=c||{};waiting_message||(waiting_message="");var j=a('<div class="af_waiting_message alert alert-warning" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> '+waiting_message+'<div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" style="width:100%"></div></div></div>');if(j.hide().appendTo("body").fadeIn(1500),g&&h)i=new FormData(e[0]),i.append("module",f[0]),i.append("act",f[1]);else{if(g)i=e[0].dataExport();else{var k=(e.attr("data-ajax-param")||"").split(",");if(k.length>1)for(var l=0,m=k.length;l<m;l+=2)i[k[l]]=k[l+1]}a.extend(i,{module:f[0],act:f[1]}),i=JSON.stringify(i)}try{a.ajax({type:"POST",url:request_uri,dataType:!h&&"json",contentType:!h&&"application/json",processData:!h,data:i,beforeSend:function(b,c){var f=!1;if(a.isFunction(d))f=!1===d("before",c,b);else{var g=a.Event("before.exec.ajax");e.trigger(g,[c,b]),f=g.isDefaultPrevented()}if(f)return j.remove(),e.data("actioning",!1),!1},complete:function(b,c){a.isFunction(d)?d("complete",c,b):e.trigger("complete.exec.ajax",[c,b]),j.remove(),e.data("actioning",!1)},success:function(b,c,f){var g,h,i,k=!1;if("string"==typeof b?(h=-1,i=f.responseText.replace(/<[^>]+>/g,"")):(h=b.error&&"0"!=b.error?b.error:0,i=h?b.message:""),a.isFunction(d)?k=!1===d(h?"error":"success",h?i:b,f):(g=a.Event(h?"error.exec.ajax":"success.exec.ajax"),e.trigger(g,h?[i,f]:[b,f]),k=g.isDefaultPrevented()),k)return j.remove(),void e.data("actioning",!1);h&&alert(i.replace(/<br[\s|\/]*>/g,"\n")),b.redirect_url&&parent.location.replace(b.redirect_url)},error:function(b,c,f){var g=c,h=!1;if("parsererror"==c?(g="The result is not valid JSON :\n--------------------------------\n",""!==b.responseText&&(g+=b.responseText.replace(/<[^>]+>/g,"")),console.log(g),g="parsererror"):g=f,a.isFunction(d))h=!1===d("error",g,b);else{var k=a.Event("error.exec.ajax");e.trigger(k,[g,b]),h=k.isDefaultPrevented()}if(h)return j.remove(),void e.data("actioning",!1);alert(g.replace(/<br[\s|\/]*>/g,"\n")),i.redirect_url&&parent.location.replace(i.redirect_url)}})}catch(a){alert(a),j.remove(),e.data("actioning",!1)}}},a(document).on("submit","form[data-exec-ajax]",function(a){a.preventDefault(),exec_ajax(this)}).on("click","[data-exec-ajax][data-ajax-param]",function(a){a.preventDefault(),exec_ajax(this)}),a(document).on("change",".fileupload-group input:file",function(b){var c=a(this),d=c.closest(".fileupload-group"),e=d.find(".file-caption"),f=c[0].hasAttribute("multiple");f&&d.addClass("file-list");var g=a.Event("insert.af.fileupload");d.trigger(g,[c.prop("files")]),g.isDefaultPrevented()||(e.html(""),a.map(c.prop("files"),function(b,c){var d=(b.type.split("/")[0]||"binary").escapeHtml(),g=b.size.shortFileSize(),h=b.name.escapeHtml()+" ("+g+")";a('<i class="file-item" title="'+(f?h:"")+'" data-type="'+d+'" data-index="'+c+'">').html(f?"":h).appendTo(e)}))}).on("click",".fileupload-group .file-caption",function(b){var c=a(this),d=c.find(".file-item"),e=c.closest(".fileupload-group"),f=e.find("input:file"),g=(f[0].hasAttribute("multiple"),e.attr("placeholder")||"");if(d.length>0){var h=a.Event("delete.af.fileupload");if(e.trigger(h,[f.prop("files")]),h.isDefaultPrevented())return;f.val(""),a('<input type="hidden" name="remove_files[]" value="'+f.attr("name")+'">').appendTo(c.text(g))}}).on("keydown",".fileupload-group .file-caption",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}).on("keydown",".fileupload-group .btn-file",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).find("input:file").click())}),a(document).on("click",".radio-control",function(b){var c=a(b.target),d=c.closest(".radio-group");if(!c[0].hasAttribute("readonly")&&!c[0].hasAttribute("disabled")&&c.hasClass("radio")){var e=c.attr("data-value")||"0";d.find("input:hidden").val(e).end().find(".radio").removeClass("active"),c.addClass("active"),d.trigger("changed.af.radio",[e])}}).on("keydown",".radio-control .radio",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}),a(document).on("click",".switch-group",function(b){var c=a(this);if(!c[0].hasAttribute("readonly")&&!c[0].hasAttribute("disabled")&&!c.data("actioning")){c.data("actioning",!0);var d=c.hasClass("on"),e=c.find(".switch-handle-on").attr("data-value")||1,f=c.find(".switch-handle-off").attr("data-value")||0,g=a.Event("change.af.switch");if(c.trigger(g,[d,d?e:f]),g.isDefaultPrevented())return void c.data("actioning",!1);c.find(".switch-control").animate({left:d?"-=100":"+=100"},500,function(){a(this).css("left",""),c.toggleClass("on").find("input:hidden").val(d?f:e).end().trigger("changed.af.switch",[!d,d?f:e]).data("actioning",!1)})}}).on("keydown",".switch-group",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}),a(document).on("keyup","input[maxbyte],textarea[maxbyte]",function(b){var c=a(this),d=c.attr("maxbyte")||0;if(!isNaN(d)){for(var e,f=0,g="",h=c.val(),i=0;!isNaN(e=h.charCodeAt(i))&&!((f+=e<128?1:e<2048?2:e<3936256?3:4)>d);i++)g+=String.fromCharCode(e);c.val(g)}}),a(window).on("load",function(){a(".fileupload-group input:file").each(function(){var b=a(this),c=b.closest(".fileupload-group"),d=c.find(".file-caption"),e=c.attr("placeholder")||"";!d.find(".file-item").length&&e&&d.text(e),d[0].hasAttribute("tabindex")||d.attr("tabindex","0"),b[0].hasAttribute("tabindex")||(b.parent().attr("tabindex","0"),b.attr("tabindex","-1"))}),a(".radio-group input:hidden").each(function(){var b=a(this),c=b.closest(".radio-group"),d=b.val();c.find(".radio").each(function(){a(this).removeClass("active"),this.hasAttribute("tabindex")||a(this).attr("tabindex","0")}),c.find('.radio[data-value="'+d+'"]').addClass("active")}),a(".switch-group input:hidden").each(function(){var b=a(this),c=b.closest(".switch-group"),d=c.find(".switch-handle-on").attr("data-value")||1;c.removeClass("on").addClass((b.val()||0)==d?"on":""),c[0].hasAttribute("tabindex")||c.attr("tabindex","0")})})}(jQuery);