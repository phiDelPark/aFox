!function(a){"use strict";function b(a,b){var c,d=JSON.parse(a.originalEvent.dataTransfer.getData("TEXT")||"{}"),e=d.title,f=d.srl||d.index,g=d.srl?request_uri+"?file="+f:"af-editor-tmpfile="+f,h=d.type.split("/")[0]||"binary";if("TEXTAREA"==b[0].tagName){switch(e=e.escapeMKDW(!1),h){case"image":c="!["+e+"]("+g+")";break;case"video":case"audio":c="["+e+"]("+g+' "_'+d.type+'_")';break;default:c="[`"+e+"`]("+g+")"}var i=b.prop("selectionStart"),j=b.val(),k=j.substring(0,i),l=j.substring(i,j.length);b.val(k+c+l)}else{switch(e=e.escapeHtml(),g=d.path?d.path+'" data-af-editor-tmpfile="'+f:g.escapeHtml(),h){case"image":c='<img src="'+g+'" alt="'+e+'">';break;case"video":case"audio":c="<"+h+' width="100%" controls>',c+='<source src="'+g+'" type="'+d.type+'">',c+="Your browser does not support the audio element.</"+h+">";break;default:c='<a href="'+g+'"><code>'+e+"</code></a>"}var m,n,o=b[0].contentWindow;if(o){var p=!1;if(o.getSelection)m=o.getSelection();else{if(!o.document.getSelection){var q=o.document.selection&&o.document.selection.createRange();return q.text&&(p=!0,m=q),!1}m=o.document.getSelection()}if(p)m.pasteHTML(c);else if(m.getRangeAt&&m.rangeCount){var r=o.document.createElement("div");r.innerHTML=c,n=m.getRangeAt(0),n.deleteContents(),n.insertNode(r)}else{var s=b.contents().find("body").html();b.contents().find("body").html(s+c)}}}}function c(a){if("image"!==a.attr("data-type").substring(0,5))a.tooltip({container:"body"});else{var b=a.attr("title"),c=a.attr("data-srl")?request_uri+"?file="+a.attr("data-srl"):a.attr("data-path");a.removeAttr("title"),b=b.substring(b.length-12,b.length),a.tooltip({html:1,container:"body",title:function(){return'<img src="'+c+'" style="width:80px;height:80px"><div style="width:80px;overflow:hidden;white-space:nowrap;">'+b+"</div>"}})}}function d(e,f){this.$element=a(e),this.$textarea=a(e).find("textarea").show(),this.options=a.extend({},d.DEFAULTS,f);var g=this;this.$element.closest("form").on("submit",function(){var a=g.$textarea.val(),b=g.$element.find("iframe");if(b.length&&(a=b.contents().find("body").html(),g.$textarea.val(a)),g.options.required&&!a)return alert(g.options.required),!1}),this.$element.on("click",".af-editor-toolbar>.pull-right",function(b){var c=a(this),d=a(b.target);d.hasClass("glyphicon")&&(d=d.parent());var e=d.attr("data-type")||"",f=d.attr("data-target")||"",g=d.attr("data-value")||"";if(e&&g&&f){var h=c.find('input[name="'+f+'"]').val(),i=a.Event("change.af.editor.toolbar");"checkbox"===e&&(g=d.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),c.parent().trigger(i,[f,h,g]),i.isDefaultPrevented()||("checkbox"===e?d.find(".glyphicon").addClass("glyphicon-"+("1"===g?"check":"unchecked")).removeClass("glyphicon-"+("1"===g?"unchecked":"check")):(c.find('[data-type="'+e+'"]').each(function(){a(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),c.find('[data-type="'+e+'"][data-value="'+g+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),c.find('input[name="'+f+'"]').val(g),c.parent().trigger("changed.af.editor.toolbar",[f,h,g]))}}).on("click",".af-editor-uploaded-list>.file-item",function(){var b=a(this),c=b.attr("data-srl"),d=a('[name="remove_files[]"][value="'+c+'"]');d.length?(d.remove(),b.css("color","").attr("title",b.attr("title").substr(9))):(a('<input type="hidden" name="remove_files[]" value="'+c+'">').insertAfter(b),b.css("color","hotpink").attr("title","(Remove) "+b.attr("title")))}).on("dragstart",".af-editor-uploaded-list>.file-item",function(b){var c=a(this);c.data&&c.data("bs.tooltip")&&c.tooltip("hide"),b.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:c.attr("data-type"),srl:c.attr("data-srl"),title:c.attr("title")}))}).on("dragover",".af-editor-area>textarea",function(a){a.preventDefault()}).on("drop",".af-editor-area>textarea",function(c){c.preventDefault(),b(c,a(this))}).on("insert.af.fileupload",".fileupload-group",function(b,d){b.preventDefault();var e=a(this).find(".file-caption"),f=a(this).find("input:file")[0].hasAttribute("multiple");e.html(""),a.map(d,function(b,d){var g=b.type.escapeHtml(),h=b.size.shortFileSize(),i=b.name.escapeHtml()+" ("+h+")",j=(window.URL||window.webkitURL).createObjectURL(b),k=a('<i class="file-item" draggable="true" title="'+(f?i:"")+'" data-type="'+g+'" data-index="'+d+'" data-path="'+j+'">');k.text(f?"":i).appendTo(e).on("dragstart",function(b){var c=a(this);b.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:c.attr("data-type"),index:c.attr("data-index"),title:f?c.attr("title"):c.text(),path:c.attr("data-path")}))}),c(k)})}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).on("show.bs.popover",function(){a(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find(".fileupload-group .file-item").each(function(){c(a(this))});var h=this.$element.find("iframe");h.length&&h.remove(),this.options.html&&this.switch(!0)}function e(b){return this.each(function(){var c=a(this),e=c.data("af.editor"),f="object"==typeof b&&b;e||c.data("af.editor",e=new d(this,f)),"string"==typeof b&&e[b]()}).data("af.editor")}d.VERSION="1.0.0",d.DEFAULTS={required:!1,readonly:!1,html:!1},d.prototype.switch=function(c){var d=this.$textarea,e=this.$element.find("iframe"),f=d.css("height")||"",g=this.options.readonly;if(c)e.length||(e=a('<iframe class="form-control vresize">').on("load",function(){var c=a(this);c.contents().find("body").on("dragover",function(a){a.preventDefault()}).on("drop",function(a){a.preventDefault(),b(a,c)}),c.contents().find("body").html(d.val()),g||(c.contents()[0].designMode="on")}).insertAfter(d.hide()).end(),g?e.attr("readonly","readonly"):e.removeAttr("readonly")),e.css("height",f);else{var h;e.length?(f=e.css("height"),h=e.contents().find("body").html(),e.remove()):h=d.val(),d.css("height",f).val(h).show(),g?d.attr("readonly","readonly"):d.removeAttr("readonly")}},d.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))};var f=a.fn.afEditor;a.fn.afEditor=e,a.fn.afEditor.Constructor=d,a.fn.afEditor.noConflict=function(){return a.fn.afEditor=f,this}}(jQuery);