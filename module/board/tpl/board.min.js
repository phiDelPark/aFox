!function(t){"use strict";var e='<form action="%s" class="input-password" method="post" autocomplete="off"><div class="form-inline"><div>%s</div><input class="form-control" name="mb_password" type="password" placeholder="%s" style="width:150px" required> <button class="btn btn-primary" type="submit">%s</button> <button class="btn btn-default" type="button">%s</button></div></form>';t("[data-exec-act]").click(function(){var r={},s=t(this),o=s.attr("data-exec-act"),a=s.attr("data-act-param");if(!a)return!1;for(var n=0,i=(a=a.split(",")).length;n<i;n+=2)r[a[n]]=a[n+1];var d=s.closest("#bdReply"),c=s.closest(".reply-item"),l=s.attr("data-act-password")||"";d.find("form.right").remove().end().find(".reply-item>.right").show();var f=d.find('[data-exec-ajax="board.updateComment"]').clone().hide(),p=f.find(".af_editor_rp_content").afEditor();f.find(".form-group").show(),f.find('[disabled="disabled"]').removeAttr("disabled");var u=function(e,r,s){if("success"==e){t('<input type="hidden" name="rp_srl" value="">').prependTo(f);var o=c.find(">.right");if("0"===r.mb_srl)f.find(".area-mbinfo").find('[name="mb_nick"],[name="mb_password"]').attr("required","required").end().removeClass("hide"),f.find(".af-editor-toolbar,.af-editor-content>textarea,.af-editor-content>iframe").removeAttr("readonly");return f[0].dataImport(r),f.addClass("right").find(".close").show().click(function(){o.show("fast",function(){f.remove()})}).end().insertAfter(o.hide("slow")).show("slow"),f.find(".btn-success").removeClass("btn-success").addClass("btn-info"),2==r.rp_type&&p.switch(!0),c[0].scrollIntoView(!0),!1}};if("board.deleteComment"==o||"board.getComment"==o&&l){var m,_=encodeURIComponent(current_url.setQuery("rp",""));if(c.find(">>.inside_massage_box").length>0)return!1;l?"board.getComment"==o?(m=t(e.sprintf("",$_LANG.request_input.sprintf($_LANG.password),$_LANG.password,$_LANG.ok,$_LANG.close))).offOn("success.exec.ajax",function(e,r,s){e.preventDefault(),u("success",r),t(this).remove()}):m=t(e.sprintf("",$_LANG.confirm_select_delete.sprintf($_LANG.comment),$_LANG.password,$_LANG.ok,$_LANG.close)):m=t('<form action="%s" class="input-group" method="post" autocomplete="off"><div><div>%s</div><button class="btn btn-primary" type="submit">%s</button> <button class="btn btn-default" type="button">%s</button></div></form>'.sprintf("",$_LANG.confirm_select_delete.sprintf($_LANG.comment),$_LANG.yes,$_LANG.no)),m.offOn("error.exec.ajax",function(e,r,s){e.preventDefault(),t(e.currentTarget).find(">div>div").css("color","red").html($_LANG.error+": "+r.message),t(e.currentTarget).find('[name="mb_password"]').val("").focus()}).hide().addClass("inside_massage_box").prependTo(c.find(">.right")).fadeIn("slow"),m.find("button.btn-default").click(function(){m.fadeOut("slow",function(){t(this).remove()})}).focus(),m.attr("data-exec-ajax",o),m.prepend('<input type="hidden" name="rp_srl" value="'+r.rp_srl+'">'),m.prepend('<input type="hidden" name="success_return_url" value="'+_+'">'),m.addClass("inside_massage_box").prependTo(c.find(">.right")).fadeIn("slow",function(){var e=t(this).find('[name="mb_password"]');e.length>0&&e.focus()})}else"board.getComment"!=o&&"board.updateComment"!=o||("board.getComment"==o?exec_ajax(o,r,u):(p.switch(!1),t('<input type="hidden" name="rp_parent" value="">').prependTo(f),f[0].dataImport({rp_type:1,rp_secret:0,rp_content:"",rp_parent:r.rp_parent}),f.addClass("right").insertAfter(c.find(">.right")).show("slow")));return f.offOn("success.exec.ajax",function(t,e,r){t.preventDefault(),e.redirect_url&&parent.location.replace(e.redirect_url.setQuery("rp",e.rp_srl))}),!1}),t('[data-exec-ajax="board.updateDocument"],[data-exec-ajax="board.updateComment"]').on("success.exec.ajax",function(e,r,s){var o="board.updateDocument"==t(this).attr("data-exec-ajax"),a=t(this).attr("data-except")||"";e.preventDefault(),r[a]="",r.redirect_url&&parent.location.replace(r.redirect_url.setQuery(o?"srl":"rp",r[o?"wr_srl":"rp_srl"]))}),t(document).on("change.af.editor.toolbar",".af-editor-toolbar",function(e,r,s,o){var a=t(this).closest(".af-editor-group");"wr_type"!=r&&"rp_type"!=r||1!=a.length||a.data("af.editor").switch("2"===o)}),t('.list-table tr[data-hot-track], [href="#requirePassword"]').click(function(){var e=t(this);"TR"==e[0].tagName&&(e=e.find(".wr_title a"));var r=e.attr("href");if("#requirePassword"==r&&e.attr("data-param")){msg_box('<form action="%s" method="post" autocomplete="off"><p>%s</p><div class="form-group"><input type="password" class="form-control" name="mb_password" placeholder="%s" required /> <span class="sr-only">%s</span></div></form>'.sprintf(current_url,$_LANG.request_input.sprintf($_LANG.password),$_LANG.password,$_LANG.password),null,["question",["OK","cancel"]],function(t,r){if("ok"!=t)return!0;var s=r.find("form"),o=e.attr("data-srl")||"",a=(e.attr("data-param")||"").split(","),n=current_url;return o&&a.length>1&&(n=n.setQuery(a),s.offOn("submit",function(){if(s.data("check success"))return!0;var t={};return t.wr_srl=o,t.mb_password=s.find('input[name="mb_password"]').val(),exec_ajax("board.checkpassword",t,function(t,e,r){return s.data("check success","success"===t),"success"===t?(s.submit(),!1):"error"===t?(s.find(">p").html($_LANG.error+": "+e.message).css("color","red"),s.find('input[name="mb_password"]').val("").focus(),!1):void 0},["wr_srl"]),!1}).attr("action",n).submit()),!1})}else location.href=r;return!1}),t("#af_gallery_modal").on("show.bs.modal",function(e){var r=0,s=t(this).find(".modal-body"),o=t(this).find(".modal-content"),a=t(this).find("button.close.prev"),n=t(this).find("button.close.next"),i=(t(e.relatedTarget).attr("data-mf-srls")||"").split(",");s.html('<img src="'+(i[r]?"./?file="+i[r]:"./common/img/no_image.png")+'">'),i.length>1?(a.show().offOn("click",function(){--r<0&&(r=i.length-1),o.css({top:"",left:""}),s.find("img").attr("src","./?file="+i[r])}),n.show().offOn("click",function(){++r>=i.length&&(r=0),o.css({top:"",left:""}),s.find("img").attr("src","./?file="+i[r])})):(a.hide(),n.hide());var d=null;o.css({top:"",left:""}),o.offOn("mouseup",function(){d=null}).offOn("mousedown",function(t){d={x:t.pageX,y:t.pageY,left:o.offset().left,top:o.offset().top}}).offOn("mousemove",function(t){if(d){var e=t.pageX,r=t.pageY,s=e-d.x,a=r-d.y;o.offset({left:d.left+s,top:d.top+a})}})}),t(window).on("load",function(){var e=t("a.active[id^=reply_]");e.length>0?e[0].scrollIntoView(!0):t(this).trigger("scroll")}).on("scroll",function(){t("img[scroll-src]").each(function(){var e=t(this);e.offset().top<t(window).scrollTop()+t(window).height()+100&&(e.attr("src",e.attr("scroll-src")||"#"),e.removeAttr("scroll-src"))})})}(jQuery);