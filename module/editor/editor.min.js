!function(c){"use strict";function s(t,e){var a,i=e.$textarea,n=JSON.parse(t.originalEvent.dataTransfer.getData("TEXT")||"{}"),r=n.title,o=n.srl||n.index,s=n.srl?request_uri+"?file="+o:"afox-editor-tmpfile="+o,l=n.type.split("/")[0]||"binary";if(i.is(":visible")&&0!==i.length){switch(r=r.escapeMKDW(!1),l){case"image":a="!["+r+"]("+s+")";break;case"video":case"audio":a="["+r+"]("+s+' "_'+n.type+'_")';break;default:a="[`"+r+"`]("+s+")"}e.paste(a,!1)}else{switch(i=e.$element.find("iframe"),r=r.escapeHtml(),s=n.path?n.path+'" afox-editor-tmpfile="'+o:s.escapeHtml(),l){case"image":a='<img src="'+s+'" alt="'+r+'">';break;case"video":case"audio":a="<"+l+' width="100%" controls>',a+='<source src="'+s+'" type="'+n.type+'">',a+="Your browser does not support the audio element.</"+l+">";break;default:a='<code><a href="'+s+'">'+r+"</a></code>"}e.paste(a,!1)}}function d(t){var e=t.attr("data-title")||t.attr("title");t.removeAttr("title"),t.attr("data-title",e);var i="";if(e="<div>"+(e=e.replace(/(.+)(\([a-zA-Z0-9.]+\)$)/g,function(t,e,a){return i=a,e.trim()}).escapeHtml())+"</div><div>"+i+"</div>","image"===t.attr("data-type").substring(0,5)){var a=t.attr("data-srl")?request_uri+"?file="+t.attr("data-srl"):t.attr("data-path");e='<img src="'+a+'" style="width:100px;height:100px"><div style="width:100px;overflow:hidden;white-space:nowrap">'+e+"</div>"}t.tooltip({html:1,container:"body",title:function(){return e}})}function n(t,e){this.$element=c(t),this.$textarea=c(t).find("textarea").show(),this.options=c.extend({},n.DEFAULTS,e);var i,r=this;this.options.required&&(i=c('<form style="position:absolute;left:0;top:0;height:1px!important;overflow:hidden!important;border:0!important;opacity:0!important" onsubmit="return false"><input type="text" required><input type="submit"></form>')).appendTo("BODY"),this.$element.closest("form").offOn("submit",function(){var t=r.$textarea.val(),e=r.$element.find("iframe");if(e.length&&(t=e.contents().find("body").html(),r.$textarea.val(t)),r.options.required&&!t){var a=e.length?e.offset():r.$textarea.offset();return i.css({left:a.left,top:a.top}).find('[type="submit"]').click(),!1}}),this.$element.offOn("click",".af-editor-toolbar>.pull-right",function(t){var e=c(this),a=c(t.target);if(!e.parent()[0].hasAttribute("readonly")){a.hasClass("glyphicon")&&(a=a.parent());var i=a.attr("data-type")||"",n=a.attr("data-target")||"",r=a.attr("data-value")||"";if(i&&r&&n){var o=e.find('input[name="'+n+'"]').val(),s=c.Event("change.af.editor.toolbar");"checkbox"===i&&(r=a.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),e.parent().trigger(s,[n,o,r]),s.isDefaultPrevented()||("checkbox"===i?a.find(".glyphicon").addClass("glyphicon-"+("1"===r?"check":"unchecked")).removeClass("glyphicon-"+("1"===r?"unchecked":"check")):(e.find('[data-type="'+i+'"]').each(function(){c(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),e.find('[data-type="'+i+'"][data-value="'+r+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),e.find('input[name="'+n+'"]').val(r),e.parent().trigger("changed.af.editor.toolbar",[n,o,r]))}}}).offOn("keydown",".af-editor-toolbar>.pull-right>span[tabindex=0]",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),c(this).click())}).offOn("click",".af-statebar-area>.btn-group>button[tabindex=-1]",function(t,e){var a=c(this),i=(r.$textarea,r.$element.find("iframe"),a.attr("aria-label"));if(a.blur(),"link"==i||"components"==i)return!1;r.exec(i,null)}).offOn("click",".af-editor-uploaded>.file-item",function(){var t=c(this),e=t.attr("data-srl"),a=c('[name="remove_files[]"][value="'+e+'"]');a.length?(a.remove(),t.css("color","").attr("title",t.attr("title").substr(9))):(c('<input type="hidden" name="remove_files[]" value="'+e+'">').insertAfter(t),t.css("color","hotpink").attr("title","(Remove) "+t.attr("title")))}).offOn("dragstart",".af-editor-uploaded>.file-item",function(t){var e=c(this);e.data&&e.data("bs.tooltip")&&e.tooltip("hide"),t.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:e.attr("data-type"),srl:e.attr("data-srl"),title:e.attr("data-title")||e.attr("title")}))}).offOn("dragover",".af-editor-content>textarea",function(t){t.preventDefault()}).offOn("drop",".af-editor-content>textarea",function(t){t.preventDefault(),s(t,r)}).offOn("insert.af.uploader",".uploader-group",function(t,e){t.preventDefault();var s=c(this).find(".file-caption"),l=c(this).find("input:file")[0].hasAttribute("multiple");s.html(""),c.map(e,function(t,e){var a=t.type.escapeHtml(),i=t.size.shortFileSize(),n=t.name.escapeHtml()+" ("+i+")",r=(window.URL||window.webkitURL).createObjectURL(t),o=c('<i class="file-item" draggable="true" title="'+(l?n:"")+'" data-type="'+a+'" data-index="'+e+'" data-path="'+r+'">');o.text(l?"":n).appendTo(s).offOn("dragstart",function(t){var e=c(this);e.data&&e.data("bs.tooltip")&&e.tooltip("hide"),t.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:e.attr("data-type"),index:e.attr("data-index"),title:l?e.attr("data-title")||e.attr("title"):e.text(),path:e.attr("data-path")}))}),d(o)})}).offOn("delete.af.uploader",".uploader-group",function(t,e){t.preventDefault();var a=c(this).find(".file-caption"),i=a.closest(".uploader-group");a.find(".file-item").tooltip("destroy").end().text(i.attr("placeholder")||""),i.find("input:file").val("")}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).offOn("show.bs.popover",function(){c(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find('.af-statebar-area [data-toggle="popover"]').popover({html:1,trigger:"manual",placement:"top",content:'<div class="input-group mw-20"></div>'}).offOn("inserted.bs.popover",function(){var t=c(this),e=t.data("bs.popover").tip().find(".popover-content"),a=t.attr("aria-label")||"";if("components"==a){if(AF_EDITOR_COMPONENTS){var i='<div class="list-group" style="margin:0">';for(var n in AF_EDITOR_COMPONENTS)i=i+'<a href="#" class="list-group-item" data-name="'+AF_EDITOR_COMPONENTS[n][0]+'">'+AF_EDITOR_COMPONENTS[n][1]+"</a>";e.attr("style","padding:0").find(".input-group").html(i+"</div>").find("a").click(function(){var t=c(this).attr("data-name");return pop_win(request_uri+"module/editor/component.php?n="+t+"&k="+r.options.name,null,null,"af_editor_components"),!1})}}else e.find(".input-group").html('<input type="text" class="form-control" placeholder="Link"><a href="#" class="btn btn-default input-group-addon">OK</a>').find("a").click(function(){var t=c(this).prev().val()||"";return r.exec(a,t),!1})}).offOn("shown.bs.popover",function(){var t=c(this),e=t.data("bs.popover").tip().find(".popover-content").find("input");0<e.length?e.focus().select():e=t,e.offOn("blur",function(){t.popover("hide")})}).offOn("click",function(){c(this).popover("toggle")}),this.$element.find(".uploader-group .file-item").each(function(){d(c(this))});var a=this.$element.find("iframe");a.length&&a.remove(),this.options.html&&this.switch(!0)}n.VERSION="1.0.0",n.DEFAULTS={required:!1,readonly:!1,html:!1},n.prototype.switch=function(t){var e,a=this,i=this.$textarea,n=this.$element.find("iframe"),r=i.css("height")||"",o=this.options.readonly;t?(n.length||(n=c('<iframe class="form-control vresize">').offOn("load",function(){var t=c(this);t.contents().find("body").offOn("dragover",function(t){t.preventDefault()}).offOn("drop",function(t){t.preventDefault(),s(t,a)}),t.contents().find("head").html('<link rel="stylesheet" href="'+request_uri+'module/editor/editor.min.css">'),t.contents().find("body").html(i.val()),o||(t.contents()[0].designMode="on")}).insertAfter(i.hide()).end(),o?n.attr("readonly","readonly"):n.removeAttr("readonly")),n.css("height",r)):(n.length?(r=n.css("height"),e=n.contents().find("body").html(),n.remove()):e=i.val(),i.css("height",r).val(e).show(),o?i.attr("readonly","readonly"):i.removeAttr("readonly"))},n.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))},n.prototype.selection=function(){var t=this.$textarea,e={};if(t.is(":visible")&&0!==t.length)t.focus(),e.target=t,e.start=t.prop("selectionStart"),e.end=t.prop("selectionEnd"),e.text=t.val().substring(e.start,e.end);else{(t=this.$element.find("iframe")).contents().find("body").focus();var a,i=t[0].contentWindow;i&&(i.getSelection?a=i.getSelection():i.document.getSelection&&(a=i.document.getSelection()),e.target=t,e.window=i,e.selection=a)}return e},n.prototype.paste=function(t,e){var a,i=this.selection();if("TEXTAREA"==i.target[0].tagName){!1!==e&&(t=t.replace(/%s/,i.text?i.text:e||""));var n=(o=i.target.val()).substring(0,i.start),r=o.substring(i.start+(i.end-i.start),o.length);i.target.val(n+t+r),i.end=i.end+t.length-i.text.length,i.target[0].setSelectionRange?i.target[0].setSelectionRange(i.start,i.end):i.target[0].createTextRange&&((a=i.target[0].createTextRange()).collapse(!0),a.moveEnd("character",i.end),a.moveStart("character",i.start),a.select()),i.target.focus()}else{if(a=i.selection.getRangeAt(0)){var o="",s=i.window.document.createElement("div");s.appendChild(a.cloneContents()),a.deleteContents(),!1!==e&&(o=s.innerText?(o=s.innerHTML.replace(/(\n|\r)/g,"").replace(/<(br|hr|\/div|\/li|\/?ul|\/?ol|\/?dl|\/th|\/td|\/?tr|table|\/?blockquote|\/?pre|\/?p|\/?h[1-9])(\s[^>]*>|>)/gi,"\n<$1>"),c("<div>"+o+"</div>").text().replace(/</g,"&lt;").replace(/>/g,"&gt;")):e||""),a.insertNode(c(t.replace(/%s/,o))[0]),!1===e&&(a.setStart(i.selection.focusNode,i.selection.focusOffset),a.setEnd(i.selection.anchorNode,i.selection.anchorOffset))}i.target.contents().find("body").focus()}},n.prototype.exec=function(t,e){var a,i=this.$textarea;switch(i.is(":visible")&&0!==i.length||(i=this.$element.find("iframe")),t){case"bold":case"italic":case"underline":case"strikeThrough":case"insertorderedlist":if("TEXTAREA"==i[0].tagName)switch(t){case"bold":this.paste("**%s**");break;case"italic":this.paste("*%s*");break;case"underline":this.paste("<u>%s</u>");break;case"strikeThrough":this.paste("~~%s~~");break;case"insertorderedlist":this.paste("\n1. %s\n2. ")}else i[0].contentWindow.document.execCommand(t,!1,e);break;case"highlight":"TEXTAREA"==i[0].tagName?this.paste("`%s`"):this.paste("<code>%s</code>","...");break;case"header":this.paste("<h2>%s</h2>","...");break;case"indent":this.paste("<blockquote>%s</blockquote>","...");break;case"codeblock":this.paste("<pre><code>%s\n</code></pre>");break;case"link":var n=/https?:\/\/([a-z\.]*youtub?e?)\.(com|be)(\/embed\/|\/watch\?v\=|\/)([^\?\&]+)(.*)/i,r=(e=decodeURIComponent(e).replace(/&amp;/g,"&")).getQuery("t")||e.getQuery("start");n.test(e)?(a='<img widget="youtube" src="'+e.replace(n,'https://img.youtube.com/vi/$4/mqdefault.jpg" width="560" height="315" vid="$4')+'"'+(r?' time="'+r+'"':"")+">\n",this.paste(a,!1)):(a='<a href="'+(e=e||"#")+'" target="_blank">%s</a>',"TEXTAREA"==i[0].tagName&&(a="<"+e+">"),this.paste(a,e))}"TEXTAREA"==i[0].tagName?i.focus():i.contents().find("body").focus()};var t=c.fn.afEditor;c.fn.afEditor=function(i){return this.each(function(){var t=c(this),e=t.data("af.editor"),a="object"==typeof i&&i;e||t.data("af.editor",e=new n(this,a)),"string"==typeof i&&e[i]()}).data("af.editor")},c.fn.afEditor.Constructor=n,c.fn.afEditor.noConflict=function(){return c.fn.afEditor=t,this}}(jQuery);