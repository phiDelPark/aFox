!function(t){"use strict";function e(t,e){var a,i=e.$textarea,n=JSON.parse(t.originalEvent.dataTransfer.getData("TEXT")||"{}"),o=n.title,r=n.srl||n.index,s=n.srl?request_uri+"?file="+r:"afox-editor-tmpfile="+r,l=n.type.split("/")[0]||"binary";if(i.is(":visible")&&0!==i.length){switch(o=o.escapeMKDW(!1),l){case"image":a="!["+o+"]("+s+")";break;case"video":case"audio":a="["+o+"]("+s+' "_'+n.type+'_")';break;default:a="[`"+o+"`]("+s+")"}e.paste(a,!1)}else{switch(i=e.$element.find("iframe"),o=o.escapeHtml(),s=n.path?n.path+'" afox-editor-tmpfile="'+r:s.escapeHtml(),l){case"image":a='<img src="'+s+'" alt="'+o+'">';break;case"video":case"audio":a="<"+l+' width="100%" controls>',a+='<source src="'+s+'" type="'+n.type+'">',a+="Your browser does not support the audio element.</"+l+">";break;default:a='<code><a href="'+s+'">'+o+"</a></code>"}e.paste(a,!1)}}function a(t){var e=t.attr("data-title")||t.attr("title");t.removeAttr("title"),t.attr("data-title",e);var a="";if(e="<div>"+(e=e.replace(/(.+)(\([a-zA-Z0-9.]+\)$)/g,function(t,e,i){return a=i,e.trim()}).escapeHtml())+"</div><div>"+a+"</div>","image"===t.attr("data-type").substring(0,5)){var i=t.attr("data-srl")?request_uri+"?file="+t.attr("data-srl"):t.attr("data-path");e='<img src="'+i+'" style="width:100px;height:100px"><div style="width:100px;overflow:hidden;white-space:nowrap">'+e+"</div>"}t.tooltip({html:1,container:"body",title:function(){return e}})}function i(n,o){this.$element=t(n),this.$textarea=t(n).find("textarea").show(),this.options=t.extend({},i.DEFAULTS,o);var r,s=this;this.options.required&&(r=t('<form style="position:absolute;left:0;top:0;height:1px!important;overflow:hidden!important;border:0!important;opacity:0!important" onsubmit="return false"><input type="text" required><input type="submit"></form>')).appendTo("BODY"),this.$element.closest("form").offOn("submit",function(){var t=s.$textarea.val(),e=s.$element.find("iframe");if(e.length&&(t=e.contents().find("body").html(),s.$textarea.val(t)),s.options.required&&!t){var a=e.length?e.offset():s.$textarea.offset();return r.css({left:a.left,top:a.top}).find('[type="submit"]').click(),!1}}),this.$element.offOn("click",".af-editor-toolbar>.pull-right",function(e){var a=t(this),i=t(e.target);if(!a.parent()[0].hasAttribute("readonly")){i.hasClass("glyphicon")&&(i=i.parent());var n=i.attr("data-type")||"",o=i.attr("data-target")||"",r=i.attr("data-value")||"";if(n&&r&&o){var s=a.find('input[name="'+o+'"]').val(),l=t.Event("change.af.editor.toolbar");"checkbox"===n&&(r=i.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),a.parent().trigger(l,[o,s,r]),l.isDefaultPrevented()||("checkbox"===n?i.find(".glyphicon").addClass("glyphicon-"+("1"===r?"check":"unchecked")).removeClass("glyphicon-"+("1"===r?"unchecked":"check")):(a.find('[data-type="'+n+'"]').each(function(){t(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),a.find('[data-type="'+n+'"][data-value="'+r+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),a.find('input[name="'+o+'"]').val(r),a.parent().trigger("changed.af.editor.toolbar",[o,s,r]))}}}).offOn("keydown",".af-editor-toolbar>.pull-right>span[tabindex=0]",function(e){13!=e.which&&32!=e.which||(e.preventDefault(),t(this).click())}).offOn("click",".af-statebar-area>.btn-group>button[tabindex=-1]",function(e,a){var i=t(this),n=(s.$textarea,s.$element.find("iframe"),i.attr("aria-label"));if(i.blur(),"link"==n||"components"==n)return!1;s.exec(n,null)}).offOn("click",".af-editor-uploaded>.file-item",function(){var e=t(this),a=e.attr("data-srl"),i=t('[name="remove_files[]"][value="'+a+'"]');i.length?(i.remove(),e.css("color","").attr("title",e.attr("title").substr(9))):(t('<input type="hidden" name="remove_files[]" value="'+a+'">').insertAfter(e),e.css("color","hotpink").attr("title","(Remove) "+e.attr("title")))}).offOn("dragstart",".af-editor-uploaded>.file-item",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),srl:a.attr("data-srl"),title:a.attr("data-title")||a.attr("title")}))}).offOn("dragover",".af-editor-content>textarea",function(t){t.preventDefault()}).offOn("drop",".af-editor-content>textarea",function(t){t.preventDefault(),e(t,s)}).offOn("insert.af.uploader",".uploader-group",function(e,i){e.preventDefault();var n=t(this).find(".file-caption"),o=t(this).find("input:file")[0].hasAttribute("multiple");n.html(""),t.map(i,function(e,i){var r=e.type.escapeHtml(),s=e.size.shortFileSize(),l=e.name.escapeHtml()+" ("+s+")",c=(window.URL||window.webkitURL).createObjectURL(e),d=t('<i class="file-item" draggable="true" title="'+(o?l:"")+'" data-type="'+r+'" data-index="'+i+'" data-path="'+c+'">');d.text(o?"":l).appendTo(n).offOn("dragstart",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),index:a.attr("data-index"),title:o?a.attr("data-title")||a.attr("title"):a.text(),path:a.attr("data-path")}))}),a(d)})}).offOn("delete.af.uploader",".uploader-group",function(e,a){e.preventDefault();var i=t(this).find(".file-caption"),n=i.closest(".uploader-group");i.find(".file-item").tooltip("destroy").end().text(n.attr("placeholder")||""),n.find("input:file").val("")}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).offOn("show.bs.popover",function(){t(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find('.af-statebar-area [data-toggle="popover"]').popover({html:1,trigger:"manual",placement:"top",content:'<div class="input-group mw-20"></div>'}).offOn("inserted.bs.popover",function(){var e=t(this),a=e.data("bs.popover").tip().find(".popover-content"),i=e.attr("aria-label")||"";if("components"==i){if(AF_EDITOR_COMPONENTS){var n='<div class="list-group" style="margin:0">';for(var o in AF_EDITOR_COMPONENTS)n=n+'<a href="#" class="list-group-item" data-name="'+AF_EDITOR_COMPONENTS[o][0]+'">'+AF_EDITOR_COMPONENTS[o][1]+"</a>";a.attr("style","padding:0").find(".input-group").html(n+"</div>").find("a").click(function(){var e=t(this).attr("data-name");return pop_win(request_uri+"module/editor/component.php?n="+e+"&k="+s.options.name,null,null,"af_editor_components"),!1})}}else a.find(".input-group").html('<input type="text" class="form-control" placeholder="Link"><a href="#" class="btn btn-default input-group-addon">OK</a>').find("a").click(function(){var e=t(this).prev().val()||"";return s.exec(i,e),!1})}).offOn("shown.bs.popover",function(){var e=t(this),a=e.data("bs.popover").tip().find(".popover-content").find("input");a.length>0?a.focus().select():a=e,a.offOn("blur",function(){e.popover("hide")})}).offOn("click",function(){t(this).popover("toggle")}),this.$element.find(".uploader-group .file-item").each(function(){a(t(this))});var l=this.$element.find("iframe");l.length&&l.remove(),this.options.html&&this.switch(!0)}i.VERSION="1.0.0",i.DEFAULTS={required:!1,readonly:!1,html:!1},i.prototype.switch=function(a){var i,n=this,o=this.$textarea,r=this.$element.find("iframe"),s=o.css("height")||"",l=this.options.readonly;a?(r.length||(r=t('<iframe class="form-control vresize">').offOn("load",function(){var a=t(this);a.contents().find("body").offOn("dragover",function(t){t.preventDefault()}).offOn("drop",function(t){t.preventDefault(),e(t,n)}),a.contents().find("head").html('<link rel="stylesheet" href="'+request_uri+'module/editor/editor.min.css">'),a.contents().find("body").html(o.val()),l||(a.contents()[0].designMode="on")}).insertAfter(o.hide()).end(),l?r.attr("readonly","readonly"):r.removeAttr("readonly")),r.css("height",s)):(r.length?(s=r.css("height"),i=r.contents().find("body").html(),r.remove()):i=o.val(),o.css("height",s).val(i).show(),l?o.attr("readonly","readonly"):o.removeAttr("readonly"))},i.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))},i.prototype.selection=function(){var t=this.$textarea,e={};if(t.is(":visible")&&0!==t.length)t.focus(),e.target=t,e.start=t.prop("selectionStart"),e.end=t.prop("selectionEnd"),e.text=t.val().substring(e.start,e.end);else{(t=this.$element.find("iframe")).contents().find("body").focus();var a,i=t[0].contentWindow;i&&(i.getSelection?a=i.getSelection():i.document.getSelection&&(a=i.document.getSelection()),e.target=t,e.window=i,e.selection=a)}return e},i.prototype.paste=function(e,a){var i,n=this.selection();if("TEXTAREA"==n.target[0].tagName){!1!==a&&(e=e.replace(/%s/,n.text?n.text:a||""));var o=n.target.val(),r=o.substring(0,n.start),s=o.substring(n.start+(n.end-n.start),o.length);n.target.val(r+e+s),n.end=n.end+e.length-n.text.length,n.target[0].setSelectionRange?n.target[0].setSelectionRange(n.start,n.end):n.target[0].createTextRange&&((i=n.target[0].createTextRange()).collapse(!0),i.moveEnd("character",n.end),i.moveStart("character",n.start),i.select()),n.target.focus()}else{if(i=n.selection.getRangeAt(0)){var l=n.window.document.createElement("div");l.appendChild(i.cloneContents()),i.deleteContents(),i.insertNode(t(e.replace(/%s/,!1===a?"":l.innerText?l.innerText:a||""))[0]),!1===a&&(i.setStart(n.selection.focusNode,n.selection.focusOffset),i.setEnd(n.selection.anchorNode,n.selection.anchorOffset))}n.target.contents().find("body").focus()}},i.prototype.exec=function(t,e){var a,i=this.$textarea;switch(i.is(":visible")&&0!==i.length||(i=this.$element.find("iframe")),t){case"bold":case"italic":case"strikeThrough":case"insertorderedlist":if("TEXTAREA"==i[0].tagName)switch(t){case"bold":this.paste("**%s**");break;case"italic":this.paste("`%s`");break;case"strikeThrough":this.paste("~~%s~~");break;case"insertorderedlist":this.paste("\n1. %s\n2. ")}else i[0].contentWindow.document.execCommand(t,!1,e);break;case"header":this.paste("<h3>%s</h3>","...");break;case"indent":this.paste("<blockquote>%s</blockquote>","...");break;case"codeblock":this.paste("<pre><code>%s\n</code></pre>");break;case"link":var n=/https?:\/\/([a-z\.]*youtub?e?)\.(com|be)(\/embed\/|\/watch\?v\=|\/)([^\?\&]+)(.*)/i,o=(e=decodeURIComponent(e).replace(/&amp;/g,"&")).getQuery("t")||e.getQuery("start");n.test(e)?(a='<img widget="youtube" src="'+e.replace(n,'https://img.youtube.com/vi/$4/mqdefault.jpg" width="560" height="315" vid="$4')+'"'+(o?' time="'+o+'"':"")+">\n",this.paste(a,!1)):(e||(e="#"),a='<a href="'+e+'" target="_blank">%s</a>',"TEXTAREA"==i[0].tagName&&(a="<"+e+">"),this.paste(a,e))}"TEXTAREA"==i[0].tagName?i.focus():i.contents().find("body").focus()};var n=t.fn.afEditor;t.fn.afEditor=function(e){return this.each(function(){var a=t(this),n=a.data("af.editor"),o="object"==typeof e&&e;n||a.data("af.editor",n=new i(this,o)),"string"==typeof e&&n[e]()}).data("af.editor")},t.fn.afEditor.Constructor=i,t.fn.afEditor.noConflict=function(){return t.fn.afEditor=n,this}}(jQuery);
