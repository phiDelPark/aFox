!function(a){"use strict";function b(a,b){var c,d=JSON.parse(a.originalEvent.dataTransfer.getData("af-editor-file-link")||{}),e=d.title,f=d.srl||d.index,g=d.srl?request_uri+"?file="+f:"af-editor-tmpfile="+f,h=d.type.split("/")[0]||"binary";if("TEXTAREA"==b[0].tagName){switch(e=e.escapeMKDW(!1),h){case"image":c="!["+e+"]("+g+")";break;case"video":case"audio":c="["+e+"]("+g+' "_'+d.type+'_")';break;default:c="[`"+e+"`]("+g+")"}var i=b.prop("selectionStart"),j=b.val(),k=j.substring(0,i),l=j.substring(i,j.length);b.val(k+c+l)}else{switch(e=e.escapeHtml(),g=d.path?d.path+'" data-af-editor-tmpfile="'+f:g.escapeHtml(),h){case"image":c='<img src="'+g+'" alt="'+e+'">';break;case"video":case"audio":c="<"+h+' width="100%" controls>',c+='<source src="'+g+'" type="'+d.type+'">',c+="Your browser does not support the audio element.</"+h+">";break;default:c='<a href="'+g+'"><code>'+e+"</code></a>"}var m,n,o=b[0].contentWindow;if(o.getSelection)if(m=o.getSelection(),m.getRangeAt&&m.rangeCount){var p=document.createElement("div");p.innerHTML=c,n=m.getRangeAt(0),n.deleteContents();for(var q,r,s=document.createDocumentFragment();q=p.firstChild;)r=s.appendChild(q);n.insertNode(s),r&&(n=n.cloneRange(),n.setStartAfter(r),n.collapse(!0),m.removeAllRanges(),m.addRange(n))}else{var t=b.contents().find("body").html();b.contents().find("body").html(t+c)}}}function c(d,e){this.$element=a(d),this.$textarea=a(d).find("textarea").show(),this.options=a.extend({},c.DEFAULTS,e);var f=this;this.$element.closest("form").on("submit",function(){var a=f.$textarea.val(),b=f.$element.find("iframe");return b.length&&(a=b.contents().find("body").html(),f.$textarea.val(a)),f.options.required&&!a?(alert(f.options.required),!1):void 0}),this.$element.on("click",".af-editor-toolbar>.pull-right",function(b){var c=a(this),d=a(b.target);d.hasClass("glyphicon")&&(d=d.parent());var e=d.attr("data-type")||"",f=d.attr("data-target")||"",g=d.attr("data-value")||"";if(e&&g&&f){var h=c.find('input[name="'+f+'"]').val(),i=a.Event("change.af.editor.toolbar");"checkbox"===e&&(g=d.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),c.parent().trigger(i,[f,h,g]),i.isDefaultPrevented()||("checkbox"===e?d.find(".glyphicon").addClass("glyphicon-"+("1"===g?"check":"unchecked")).removeClass("glyphicon-"+("1"===g?"unchecked":"check")):(c.find('[data-type="'+e+'"]').each(function(){a(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),c.find('[data-type="'+e+'"][data-value="'+g+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),c.find('input[name="'+f+'"]').val(g),c.parent().trigger("changed.af.editor.toolbar",[f,h,g]))}}).on("click",".af-editor-uploaded-list>.file-item",function(){var b=a(this),c=b.attr("data-srl"),d=a('[name="remove_files[]"][value="'+c+'"]');d.length?(d.remove(),b.css("color","").attr("title",b.attr("title").substr(9))):(a('<input type="hidden" name="remove_files[]" value="'+c+'">').insertAfter(b),b.css("color","hotpink").attr("title","(Remove) "+b.attr("title")))}).on("dragstart",".af-editor-uploaded-list>.file-item",function(b){var c=a(this);b.originalEvent.dataTransfer.setData("af-editor-file-link",JSON.stringify({type:c.attr("data-type"),srl:c.attr("data-srl"),title:c.attr("title")}))}).on("dragover",".af-editor-area>textarea",function(a){a.preventDefault()}).on("drop",".af-editor-area>textarea",function(c){c.preventDefault(),b(c,a(this))}).on("insert.af.fileupload",".fileupload-group",function(b,c){b.preventDefault();var d=a(this).find(".file-caption"),e=a(this).find("input:file")[0].hasAttribute("multiple");d.html(""),a.map(c,function(b,c){var f=b.type.escapeHtml(),g=b.size.shortFileSize(),h=b.name.escapeHtml()+" ("+g+")",i=(window.URL||window.webkitURL).createObjectURL(b);a('<i class="file-item" draggable="true" title="'+(e?h:"")+'" data-type="'+f+'" data-index="'+c+'" data-path="'+i+'">').html(e?"":h).appendTo(d).on("dragstart",function(b){var c=a(this);b.originalEvent.dataTransfer.setData("af-editor-file-link",JSON.stringify({type:c.attr("data-type"),index:c.attr("data-index"),title:c.attr("title"),path:c.attr("data-path")}))})})});var g=this.$element.find("iframe");g.length&&g.remove(),this.options.html&&this["switch"](!0)}function d(b){return this.each(function(){var d=a(this),e=d.data("af.editor"),f="object"==typeof b&&b;e||d.data("af.editor",e=new c(this,f)),"string"==typeof b&&e[b]()}).data("af.editor")}c.VERSION="1.0.0",c.DEFAULTS={required:!1,readonly:!1,html:!1},c.prototype["switch"]=function(c){var d,e=1===this.options.readonly,f=this.$element.find("iframe"),g=this.$textarea.css("height")||"";c?(f.length||(f=a('<iframe class="form-control vresize">').insertAfter(this.$textarea.hide()).end(),e?f.attr("readonly","readonly"):f.removeAttr("readonly"),f.contents().find("body").on("dragover",function(a){a.preventDefault()}).on("drop",function(a){a.preventDefault(),b(a,f)})),f.css("height",g),f.contents().find("body").html(this.$textarea.val()),0===e&&(f.contents()[0].designMode="on")):(f.length?(g=f.css("height"),d=f.contents().find("body").html(),f.remove()):d=this.$textarea.val(),this.$textarea.css("height",g).val(d).show(),e?this.$textarea.attr("readonly","readonly"):this.$textarea.removeAttr("readonly"))},c.prototype.toggle=function(){this["switch"](this.$textarea.is(":visible"))};var e=a.fn.afEditor;a.fn.afEditor=d,a.fn.afEditor.Constructor=c,a.fn.afEditor.noConflict=function(){return a.fn.afEditor=e,this}}(jQuery);