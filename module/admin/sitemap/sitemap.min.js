let siteMap_tempKey=-1;function SiteMap(e){const t=document.querySelector(e);let o=!1,n={x:0,y:0},r={top:0,left:0,right:0,bottom:0},l=[],a=null,s=null,p=null,i=null;const c=(e,t)=>{let o=0,n=0;for(;e&&e!=t;)o+=e.offsetTop,n+=e.offsetLeft,e=e.offsetParent;return{top:o,left:n}},u=e=>{let t,o,s,c,u,d,m="LI"!=e.target.tagName?e.target.closest("LI"):e.target;if(!m||"LI"!=m.tagName)return!1;a=null,t={x:n.x-e.pageX,y:n.y-e.pageY},o=r.top-t.y-10;let y=m.querySelector("[type=text]")?.offsetHeight||38;for(s=0,c=l.length;s<c;s++)if(d=o+y,u=l[s],0===s&&d<u.top&&(d=u.top),s==c-1&&d>u.bottom&&(d=u.bottom),u.top<=d&&u.bottom>=d){a={element:u.item,state:(f=u,g=d,Math.abs(f.top-g)<=3?(i.style.top=f.top-3+"px",i.style.height="2px","before"):Math.abs(f.bottom-g)<=3?(i.style.top=f.bottom-3+"px",i.style.height="2px","after"):(i.style.top=f.top-3+"px",i.style.height=f.bottom-f.top+"px","prepend"))};break}var f,g;return p.style.display="block",p.style.top=o+"px",!1},d=e=>{if(o=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),s.style.opacity="1",p.remove(),i.remove(),!a)return!1;let t="LI"!=a.element.tagName?a.element.closest("LI"):a.element;switch(a.state){case"after":t.after(s);break;case"before":t.before(s);break;case"prepend":let e=a.element.querySelector("UL");e||(e=document.createElement("ul"),a.element.append(e)),e.append(s);break}let n=s.querySelector('input[name="parent_key[]"]'),r=s.parentNode.closest("LI");return n.value=r?.querySelector('input[name="item_key[]"]').value||"0",!1};t.addEventListener("mousedown",(e=>{if(["UL","INPUT","TEXTAREA"].indexOf(e.target.tagName)>-1||1!=e.which)return;o=!0,s="LI"!=e.target.tagName?e.target.closest("LI"):e.target,s.style.opacity=".5",p=s.cloneNode(!0),p.classList.add("draggable"),i=document.createElement("li"),i.classList.add("placeholder");const a=t.querySelectorAll("LI"),m=s.getBoundingClientRect();t.append(p),t.append(i);let y=s.querySelector("[type=text]")?.offsetHeight||38;return l=[],a.forEach((e=>{let o=c(e,t);l.push({top:o.top,bottom:o.top+y+8,item:e})})),n={x:e.pageX,y:e.pageY},r=c(s,t),p.style.cssText=`\n\t\t\tdisplay: none;\n\t\t\tposition: absolute;\n\t\t\topacity: .5;\n\t\t\twidth: ${m.width}px;\n\t\t\theight: ${m.height}px;\n\t\t\tleft: ${r.left}px;\n\t\t\ttop: ${r.top}px;\n\t\t\tz-index: 100;\n\t\t`,i.style.cssText=`\n\t\t\tposition: absolute;\n\t\t\topacity: .6;\n\t\t\twidth: ${m.width}px;\n\t\t\theight: 2px;\n\t\t\tleft: ${r.left}px;\n\t\t\ttop: ${r.top}px;\n\t\t\tz-index: 99;\n\t\t`,document.addEventListener("mousemove",u),document.addEventListener("mouseup",d),!1})),t.addEventListener("mouseover",(e=>!1)),t.addEventListener("mouseout",(e=>!1));t.querySelectorAll("li input[value=delete]").forEach((e=>{e.addEventListener("click",(e=>{if(e.preventDefault(),!confirm($_LANG.confirm_delete.sprintf([$_LANG.menu])))return;("LI"!=e.target.tagName?e.target.closest("LI"):e.target).remove()}))}));t.querySelectorAll("li input[value=setup]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const o=e.closest("LI"),n=o.querySelector(".input"),r=o.querySelector(".setup");n.classList.toggle("d-none"),r.classList.toggle("d-none")}))}));t.closest("FORM").addEventListener("submit",(e=>{try{return e.target.querySelectorAll("input[type=checkbox]").forEach((e=>{e.checked&&(e.value=1),e.setAttribute("type","hidden")})),!0}catch(t){return e.preventDefault(),!1}}))}window.onload=function(){window.siteMapItemAdd=(e,t)=>{try{const e=document.querySelector("#siteMapRoot"+t),o=document.querySelector("#siteMap_item_template li").cloneNode(!0),n=o.querySelector("input[value=delete]"),r=o.querySelector("input[value=setup]");o.querySelector('input[name="item_key[]"]').value=siteMap_tempKey--,n.addEventListener("click",(e=>{if(e.preventDefault(),!confirm($_LANG.confirm_delete.sprintf([$_LANG.menu])))return;("LI"!=e.target.tagName?e.target.closest("LI"):e.target).remove()})),r.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest("LI"),o=t.querySelector(".input"),n=t.querySelector(".setup");o.classList.toggle("d-none"),n.classList.toggle("d-none")})),e.prepend(o)}catch(e){}return!1};new SiteMap("#siteMapRoot1"),new SiteMap("#siteMapRoot2")};