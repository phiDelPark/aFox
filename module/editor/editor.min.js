!function(t){"use strict";function e(t,e){var n,i=JSON.parse(t.originalEvent.dataTransfer.getData("TEXT")||"{}"),r=i.title,o=i.srl||i.index,l=i.srl?request_uri+"?file="+o:"af-editor-tmpfile="+o,s=i.type.split("/")[0]||"binary";if("TEXTAREA"==e[0].tagName){switch(r=r.escapeMKDW(!1),s){case"image":n="!["+r+"]("+l+")";break;case"video":case"audio":n="["+r+"]("+l+' "_'+i.type+'_")';break;default:n="[`"+r+"`]("+l+")"}a(n,"","",e),e.focus()}else{switch(r=r.escapeHtml(),l=i.path?i.path+'" data-af-editor-tmpfile="'+o:l.escapeHtml(),s){case"image":n='<img src="'+l+'" alt="'+r+'">';break;case"video":case"audio":n="<"+s+' width="100%" controls>',n+='<source src="'+l+'" type="'+i.type+'">',n+="Your browser does not support the audio element.</"+s+">";break;default:n='<a href="'+l+'"><code>'+r+"</code></a>"}a(n,"","",e),e.contents().find("body").focus()}}function a(e,a,n,i){var r;if("TEXTAREA"==i[0].tagName){var o=i.prop("selectionStart"),l=i.prop("selectionEnd"),s=i.val(),d=s.substring(0,o),c=s.substring(o+(l-o),s.length),h=s.substring(o,l);i.val(d+e+(h||n)+a+c),l=l+e.length+a.length,i[0].setSelectionRange?i[0].setSelectionRange(o,l):i[0].createTextRange&&((r=i[0].createTextRange()).collapse(!0),r.moveEnd("character",l),r.moveStart("character",o),r.select())}else{var p,f=!1,u=i[0].contentWindow;if(u){if(u.getSelection)p=u.getSelection();else if(u.document.getSelection)p=u.document.getSelection();else{if(!(p=u.document.selection&&u.document.selection.createRange()).text)return!1;f=!0}if(f)p.pasteHTML(e+(p.text?p.text:n)+a);else if(p.getRangeAt&&p.rangeCount){r=p.getRangeAt(0);var g=u.document.createElement("div");g.appendChild(r.cloneContents()),g=t(e+(g.innerText?g.innerText:n)+a)[0],r.deleteContents(),r.insertNode(g)}}}}function n(t,e,n){var i="",r="";switch(t){case"bold":i="**",r="**";break;case"italic":i="`",r="`";break;case"underline":i="~~",r="~~";break;case"header":i="\n### ";break;case"insertorderedlist":i="\n1. ",r="\n2. ";break;case"indent":i="\n> ",r="";break;case"codeblock":i="\n```\n",r="\n```\n";break;case"link":i="<"+e+">",r="";break;case"video":var o=/https?:\/\/([a-z\.]*youtub?e?)\.(com|be)(\/embed\/|\/watch\?v\=|\/)([^\?\&]+)(.*)/i,l=e.getQuery("t")||e.getQuery("start");i='<img class="afox_widget" widget="youtube" src="'+e.replace(o,'https://img.youtube.com/vi/$4/mqdefault.jpg" width="560" height="315" vid="$4')+'"'+(l?' time="'+l+'"':"")+">\n",r=""}(i||r)&&a(i,r,"",n),n.focus()}function i(t,e,i){switch(t){case"bold":case"italic":case"underline":case"insertorderedlist":i[0].contentWindow.document.execCommand(t,!1,e);break;case"header":a("<h3>","</h3>","&nbsp;",i);break;case"indent":a("<blockquote>","</blockquote>","&nbsp;",i);break;case"codeblock":a("<pre><code>","</code></pre>","&nbsp;",i);break;case"link":a('<a href="'+e+'" target="_blank">',"</a>",e,i);break;case"video":n("video",e,i)}i.contents().find("body").focus()}function r(t){var e=t.attr("title");if(t.removeAttr("title"),t.attr("data-title",e),"image"!==t.attr("data-type").substring(0,5))t.tooltip({container:"body"});else{var a=t.attr("data-srl")?request_uri+"?file="+t.attr("data-srl"):t.attr("data-path");e=e.substring(e.length-12,e.length),t.tooltip({html:1,container:"body",title:function(){return'<img src="'+a+'" style="width:80px;height:80px"><div style="width:80px;overflow:hidden;white-space:nowrap;">'+e+"</div>"}})}}function o(a,l){this.$element=t(a),this.$textarea=t(a).find("textarea").show(),this.options=t.extend({},o.DEFAULTS,l);var s=this;this.$element.closest("form").on("submit",function(){var t=s.$textarea.val(),e=s.$element.find("iframe");if(e.length&&(t=e.contents().find("body").html(),s.$textarea.val(t)),s.options.required&&!t)return alert(s.options.required),!1}),this.$element.on("click",".af-editor-toolbar>.pull-right",function(e){var a=t(this),n=t(e.target);if(!a.parent()[0].hasAttribute("readonly")){n.hasClass("glyphicon")&&(n=n.parent());var i=n.attr("data-type")||"",r=n.attr("data-target")||"",o=n.attr("data-value")||"";if(i&&o&&r){var l=a.find('input[name="'+r+'"]').val(),s=t.Event("change.af.editor.toolbar");"checkbox"===i&&(o=n.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),a.parent().trigger(s,[r,l,o]),s.isDefaultPrevented()||("checkbox"===i?n.find(".glyphicon").addClass("glyphicon-"+("1"===o?"check":"unchecked")).removeClass("glyphicon-"+("1"===o?"unchecked":"check")):(a.find('[data-type="'+i+'"]').each(function(){t(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),a.find('[data-type="'+i+'"][data-value="'+o+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),a.find('input[name="'+r+'"]').val(o),a.parent().trigger("changed.af.editor.toolbar",[r,l,o]))}}}).on("keydown",".af-editor-toolbar>.pull-right>span[tabindex=0]",function(e){13!=e.which&&32!=e.which||(e.preventDefault(),t(this).click())}).on("click",".af-statebar-area>.btn-group>button[tabindex=-1]",function(e,a){var r=t(this),o=s.$textarea,l=s.$element.find("iframe"),d=r.attr("data-type");if(r.blur(),"link"==d||"video"==d)return!1;o.is(":visible")&&o.length>0?n(d,null,o):l.length>0&&i(d,null,l)}).on("click",".af-editor-uploaded>.file-item",function(){var e=t(this),a=e.attr("data-srl"),n=t('[name="remove_files[]"][value="'+a+'"]');n.length?(n.remove(),e.css("color","").attr("title",e.attr("title").substr(9))):(t('<input type="hidden" name="remove_files[]" value="'+a+'">').insertAfter(e),e.css("color","hotpink").attr("title","(Remove) "+e.attr("title")))}).on("dragstart",".af-editor-uploaded>.file-item",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),srl:a.attr("data-srl"),title:a.attr("data-title")||a.attr("title")}))}).on("dragover",".af-editor-content>textarea",function(t){t.preventDefault()}).on("drop",".af-editor-content>textarea",function(a){a.preventDefault(),e(a,t(this))}).on("insert.af.uploader",".uploader-group",function(e,a){e.preventDefault();var n=t(this).find(".file-caption"),i=t(this).find("input:file")[0].hasAttribute("multiple");n.html(""),t.map(a,function(e,a){var o=e.type.escapeHtml(),l=e.size.shortFileSize(),s=e.name.escapeHtml()+" ("+l+")",d=(window.URL||window.webkitURL).createObjectURL(e),c=t('<i class="file-item" draggable="true" title="'+(i?s:"")+'" data-type="'+o+'" data-index="'+a+'" data-path="'+d+'">');c.text(i?"":s).appendTo(n).on("dragstart",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),index:a.attr("data-index"),title:i?a.attr("data-title")||a.attr("title"):a.text(),path:a.attr("data-path")}))}),r(c)})}).on("delete.af.uploader",".uploader-group",function(e,a){e.preventDefault();var n=t(this).find(".file-caption"),i=n.closest(".uploader-group");n.find(".file-item").tooltip("destroy").end().text(i.attr("placeholder")||""),i.find("input:file").val("")}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).on("show.bs.popover",function(){t(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find('.af-statebar-area [data-toggle="popover"]').popover({html:1,trigger:"manual",placement:"top",content:'<div class="input-group"><input type="text" class="form-control" style="width:150px"><a href="#" class="btn btn-default input-group-addon">OK</a></div>'}).click(function(){t(this).popover("toggle")}).on("inserted.bs.popover",function(){var e=t(this),a=e.data("bs.popover").tip().find(".popover-content"),r=e.attr("data-type")||"";a.find("input").attr("placeholder","video"==r?"YouTube":"Link"),a.find("a").click(function(){var a=t(this).prev().val()||"",o=s.$textarea,l=s.$element.find("iframe");return o.is(":visible")&&o.length>0?n(r,a,o):l.length>0&&i(r,a,l),e.popover("hide"),!1})}),this.$element.find(".uploader-group .file-item").each(function(){r(t(this))});var d=this.$element.find("iframe");d.length&&d.remove(),this.options.html&&this.switch(!0)}o.VERSION="1.0.0",o.DEFAULTS={required:!1,readonly:!1,html:!1},o.prototype.switch=function(a){var n=this.$textarea,i=this.$element.find("iframe"),r=n.css("height")||"",o=this.options.readonly;if(a)i.length||(i=t('<iframe class="form-control vresize">').on("load",function(){var a=t(this);a.contents().find("body").on("dragover",function(t){t.preventDefault()}).on("drop",function(t){t.preventDefault(),e(t,a)}),a.contents().find("head").html('<link rel="stylesheet" href="'+request_uri+'module/editor/editor.min.css">'),a.contents().find("body").html(n.val()),o||(a.contents()[0].designMode="on")}).insertAfter(n.hide()).end(),o?i.attr("readonly","readonly"):i.removeAttr("readonly")),i.css("height",r);else{var l;i.length?(r=i.css("height"),l=i.contents().find("body").html(),i.remove()):l=n.val(),n.css("height",r).val(l).show(),o?n.attr("readonly","readonly"):n.removeAttr("readonly")}},o.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))};var l=t.fn.afEditor;t.fn.afEditor=function(e){return this.each(function(){var a=t(this),n=a.data("af.editor"),i="object"==typeof e&&e;n||a.data("af.editor",n=new o(this,i)),"string"==typeof e&&n[e]()}).data("af.editor")},t.fn.afEditor.Constructor=o,t.fn.afEditor.noConflict=function(){return t.fn.afEditor=l,this}}(jQuery);