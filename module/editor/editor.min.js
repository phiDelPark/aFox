function afoxEditor(e,t){this.htmlMode=!1,this.required=t.required,this.readonly=t.readonly,this.theme=window.localStorage.getItem("theme");const o=document.querySelector("#editor"+e.toUcFirst()),n=document.createElement("iframe"),s=o.querySelector("[name="+e+"]"),i=o.querySelectorAll("#editorTypebar [data-target]"),a=o.querySelectorAll("#editorToolbar button"),r=o.querySelectorAll('[name="upload_files[]"]'),d=o.querySelector("#uploadFiles"),l=o.querySelectorAll("#uploadedFiles img"),c=e=>{this.htmlMode=s.classList.contains("d-none"),e&&!this.htmlMode?(n.style.height=s.offsetHeight+"px",n.contentWindow.document.body.innerHTML=s.value,s.classList.add("d-none"),n.classList.remove("d-none"),this.required&&s.removeAttribute("required")):!e&&this.htmlMode&&(s.style.height=n.offsetHeight+"px",s.value=n.contentWindow.document.body.innerHTML,n.classList.add("d-none"),s.classList.remove("d-none"),this.required&&s.setAttribute("required","")),this.htmlMode=s.classList.contains("d-none")};this.querySelector=e=>(this.htmlMode||(n.contentWindow.document.body.innerHTML=s.value),n.contentWindow.document.body.querySelector(e)),this.querySelectorAll=e=>(this.htmlMode||(n.contentWindow.document.body.innerHTML=s.value),n.contentWindow.document.body.querySelectorAll(e)),this.getSelection=()=>{const e=n.contentWindow;return this.htmlMode?e.document.body.focus():s.focus(),this.htmlMode?e.getSelection?e.getSelection():e.document.getSelection?e.document.getSelection():void 0:{start:s.selectionStart,end:s.selectionEnd,value:s.value.slice(s.selectionStart,s.selectionEnd)}},this.pasteHtml=e=>{const t=this.getSelection();if(this.htmlMode){let o=t.getRangeAt(0);if(o){const s=n.contentWindow.document.createElement("div");s.appendChild(o.cloneContents()),s.innerHTML=e.replace(/%s/,s.innerHTML?s.innerHTML:"..."),o.deleteContents(),o.insertNode(s.firstElementChild),o.setStart(t.focusNode,t.focusOffset),o.setEnd(t.anchorNode,t.anchorOffset)}}else{const o=-1*(s.value.length-t.end);e=e.replace(/%s/,t.value?t.value:"...");const n=s.value.slice(0,t.start),i=o?s.value.slice(o):"";s.value=n+e+i}},n.classList.add("form-control","resizable","p-0","d-none"),n.addEventListener("load",(e=>{const t=`<meta http-equiv="Pragma" content="no-cache">\n\t\t<meta http-equiv="Cache-Control" content="no-cache">\n\t\t<link rel="stylesheet" href="${request_uri}module/editor/editor.min.css">`;n.style.resize="vertical",this.theme&&n.contentWindow.document.documentElement.setAttribute("data-bs-theme",this.theme),n.contentWindow.document.head.innerHTML=t,n.contentWindow.document.designMode=this.readonly?"off":"on",n.contentWindow.document.body.innerHTML=s.value,n.contentWindow.document.body.addEventListener("drop",(e=>{e.preventDefault(),this.pasteHtml(e.dataTransfer.getData("text")||"")})),n.contentWindow.document.body.addEventListener("focus",(e=>n.classList.add("focused"))),n.contentWindow.document.body.addEventListener("blur",(e=>n.classList.remove("focused","is-invalid")))})),s.parentNode.insertBefore(n,s),this.readonly&&(s.readOnly=!0);const u=e=>{const t=e.target.getAttribute("src").getQuery("file"),n=o.querySelector('[name="remove_files[]"][value="'+t+'"]');if(n)n.remove();else{const o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","remove_files[]"),o.setAttribute("value",t),e.target.parentNode.insertBefore(o,e.target)}},h=e=>{const t=e.target.getAttribute("src").getQuery("file");if(o.querySelector('[name="remove_files[]"][value="'+t+'"]'))return e.preventDefault(),e.stopPropagation(),!1;if(/<[img][^>]+[class]=[\\"\']+image\//g.test(e.target.outerHTML))e.dataTransfer.setData("text",e.target.outerHTML);else{const t=e.target.outerHTML.replace(/^(<[img]+\ssrc)([^>]+title=[\\"\']+)([^>\\"\']+)([^>]+)srcset=[\\"\']+[^>\\"\']+([^>]+>)$/g,'<a href$2$3$4target="_file$5$3</a>');e.dataTransfer.setData("text",t)}};l.forEach((e=>{e.addEventListener("click",u),e.addEventListener("dragstart",h)}));const m=e=>{for(window.dispatchEvent(new Event("beforeunload",{bubbles:!0,cancelable:!1}));d.firstChild;)d.removeChild(d.lastChild);const t=window.URL||window.webkitURL;Object.keys(e.target.files).map((o=>{let n=document.createElement("span"),s=e.target.files[o].name.escapeHTML(),i=e.target.files[o].type.escapeHTML(),a=e.target.files[o].size.shortFileSize(),r=t.createObjectURL(e.target.files[o]);window.uploadFiles.push(r);const l=window.uploadFiles.length-1;"image"!=i.slice(0,5)&&(i+='" srcset="./module/editor/bi-binary.svg');let c=`="${r}" title="${s} (${a})" alt="${s}" target="${l}"`;n.innerHTML='<image class="'+i+'" src'+c+">"+(1===e.target.files.length?"<span>"+e.target.value+"</span>":""),c="image"==i.slice(0,5)?"<image src"+c+">":`<a href${c}>${s} (${a})</a>`,n.addEventListener("dragstart",(e=>{e.dataTransfer.setData("text",c)})),d.append(n)}))};r.forEach((e=>e.addEventListener("change",m)));const g=e=>{e.preventDefault(),e.stopPropagation();const t={bold:this.htmlMode?"<strong>%s</strong>":"**%s**",italic:this.htmlMode?"<em>%s</em>":"*%s*",underline:"<u>%s</u>",strikethrough:this.htmlMode?"<strike>%s</strike>":"~~%s~~",insertorderedlist:this.htmlMode?"<ol><li>%s</li></ol>":"\n1. %s\n2. ",header:this.htmlMode?"<h2>%s</h2>":"## %s",highlight:this.htmlMode?"<code>%s</code>":"`%s`",indent:this.htmlMode?"<blockquote>%s</blockquote>":"> %s",codeblock:this.htmlMode?"<pre><code>%s</code></pre>":"```\n%s\n```"},o=e.target.closest("button").getAttribute("aria-label").toLowerCase();switch(o){case"components":break;default:this.pasteHtml(t[o]);break}this.htmlMode?n.contentWindow.document.body.focus():s.focus()},f=e=>{e.preventDefault(),e.stopPropagation();const t=o.querySelector("[name="+e.target.dataset.target+"]"),a=e.target.dataset.value;"true"==a?(t.value=t.value==a?"false":"true","true"==t.value?e.target.classList.add("checked"):e.target.classList.remove("checked")):(i.forEach((e=>{"true"!=e.getAttribute("data-value")&&e.classList.remove("checked")})),t.value=a,e.target.classList.add("checked"),c("HTML"===e.target.innerText)),this.htmlMode?n.contentWindow.document.body.focus():s.focus()};a.forEach((e=>e.addEventListener("click",g))),i.forEach((e=>e.addEventListener("click",f))),i.forEach((e=>e.addEventListener("keydown",(e=>{32==e.which&&!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),e.target.click())}))));const v=o.closest("FORM"),p=v.querySelectorAll(".checkbox-group.required");p.forEach((e=>e.addEventListener("change",(t=>e.classList.remove("is-invalid"))))),v.hasAttribute("needvalidate")&&v.setAttribute("novalidate",""),v.addEventListener("submit",(e=>{try{if(this.htmlMode&&(s.value=n.contentWindow.document.body.innerHTML),p.forEach((t=>{0===t.querySelectorAll("[type=checkbox]:checked")?.length&&(t.classList.add("is-invalid"),e.preventDefault(),e.stopPropagation())})),content_validity=!this.required||s.value,e.currentTarget.hasAttribute("needvalidate"))content_validity&&e.currentTarget.checkValidity()||(e.preventDefault(),e.stopPropagation(),content_validity||n.classList.add("is-invalid")),e.currentTarget.classList.add("was-validated");else if(!content_validity)throw this.htmlMode?n.contentWindow.document.body.focus():s.focus(),new Error(this.required)}catch(t){e.preventDefault(),e.stopPropagation(),alert(t)}}),!1),t.html&&c(!0)}!function(){"use strict";window.uploadFiles=[],window.addEventListener("beforeunload",(e=>{let t;const o=window.URL||window.webkitURL;for(;window.uploadFiles.length>0;)t=window.uploadFiles.pop(),o.revokeObjectURL(t)}))}();