!function(t){"use strict";function e(t,e){var a,i=e.$textarea,n=JSON.parse(t.originalEvent.dataTransfer.getData("TEXT")||"{}"),o=n.title,r=n.srl||n.index,s=n.srl?request_uri+"?file="+r:"af-editor-tmpfile="+r,l=n.type.split("/")[0]||"binary";if(i.is(":visible")&&0!==i.length){switch(o=o.escapeMKDW(!1),l){case"image":a="!["+o+"]("+s+")";break;case"video":case"audio":a="["+o+"]("+s+' "_'+n.type+'_")';break;default:a="[`"+o+"`]("+s+")"}e.paste(a,!1)}else{switch(i=e.$element.find("iframe"),o=o.escapeHtml(),s=n.path?n.path+'" data-af-editor-tmpfile="'+r:s.escapeHtml(),l){case"image":a='<img src="'+s+'" alt="'+o+'">';break;case"video":case"audio":a="<"+l+' width="100%" controls>',a+='<source src="'+s+'" type="'+n.type+'">',a+="Your browser does not support the audio element.</"+l+">";break;default:a='<a href="'+s+'"><code>'+o+"</code></a>"}e.paste(a,!1)}}function a(t){var e=t.attr("title");if(t.removeAttr("title"),t.attr("data-title",e),"image"!==t.attr("data-type").substring(0,5))t.tooltip({container:"body"});else{var a=t.attr("data-srl")?request_uri+"?file="+t.attr("data-srl"):t.attr("data-path");e=e.substring(e.length-17,e.length),t.tooltip({html:1,container:"body",title:function(){return'<img src="'+a+'" style="width:100px;height:100px"><div style="width:100px;overflow:hidden;white-space:nowrap;">'+e+"</div>"}})}}function i(n,o){this.$element=t(n),this.$textarea=t(n).find("textarea").show(),this.options=t.extend({},i.DEFAULTS,o);var r=this;this.$element.closest("form").on("submit",function(){var t=r.$textarea.val(),e=r.$element.find("iframe");if(e.length&&(t=e.contents().find("body").html(),r.$textarea.val(t)),r.options.required&&!t)return alert(r.options.required),!1}),this.$element.on("click",".af-editor-toolbar>.pull-right",function(e){var a=t(this),i=t(e.target);if(!a.parent()[0].hasAttribute("readonly")){i.hasClass("glyphicon")&&(i=i.parent());var n=i.attr("data-type")||"",o=i.attr("data-target")||"",r=i.attr("data-value")||"";if(n&&r&&o){var s=a.find('input[name="'+o+'"]').val(),l=t.Event("change.af.editor.toolbar");"checkbox"===n&&(r=i.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),a.parent().trigger(l,[o,s,r]),l.isDefaultPrevented()||("checkbox"===n?i.find(".glyphicon").addClass("glyphicon-"+("1"===r?"check":"unchecked")).removeClass("glyphicon-"+("1"===r?"unchecked":"check")):(a.find('[data-type="'+n+'"]').each(function(){t(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),a.find('[data-type="'+n+'"][data-value="'+r+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),a.find('input[name="'+o+'"]').val(r),a.parent().trigger("changed.af.editor.toolbar",[o,s,r]))}}}).on("keydown",".af-editor-toolbar>.pull-right>span[tabindex=0]",function(e){13!=e.which&&32!=e.which||(e.preventDefault(),t(this).click())}).on("click",".af-statebar-area>.btn-group>button[tabindex=-1]",function(e,a){var i=t(this),n=(r.$textarea,r.$element.find("iframe"),i.attr("data-type"));if(i.blur(),"link"==n||"components"==n)return!1;r.exec(n,null)}).on("click",".af-editor-uploaded>.file-item",function(){var e=t(this),a=e.attr("data-srl"),i=t('[name="remove_files[]"][value="'+a+'"]');i.length?(i.remove(),e.css("color","").attr("title",e.attr("title").substr(9))):(t('<input type="hidden" name="remove_files[]" value="'+a+'">').insertAfter(e),e.css("color","hotpink").attr("title","(Remove) "+e.attr("title")))}).on("dragstart",".af-editor-uploaded>.file-item",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),srl:a.attr("data-srl"),title:a.attr("data-title")||a.attr("title")}))}).on("dragover",".af-editor-content>textarea",function(t){t.preventDefault()}).on("drop",".af-editor-content>textarea",function(t){t.preventDefault(),e(t,r)}).on("insert.af.uploader",".uploader-group",function(e,i){e.preventDefault();var n=t(this).find(".file-caption"),o=t(this).find("input:file")[0].hasAttribute("multiple");n.html(""),t.map(i,function(e,i){var r=e.type.escapeHtml(),s=e.size.shortFileSize(),l=e.name.escapeHtml()+" ("+s+")",c=(window.URL||window.webkitURL).createObjectURL(e),d=t('<i class="file-item" draggable="true" title="'+(o?l:"")+'" data-type="'+r+'" data-index="'+i+'" data-path="'+c+'">');d.text(o?"":l).appendTo(n).on("dragstart",function(e){var a=t(this);a.data&&a.data("bs.tooltip")&&a.tooltip("hide"),e.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:a.attr("data-type"),index:a.attr("data-index"),title:o?a.attr("data-title")||a.attr("title"):a.text(),path:a.attr("data-path")}))}),a(d)})}).on("delete.af.uploader",".uploader-group",function(e,a){e.preventDefault();var i=t(this).find(".file-caption"),n=i.closest(".uploader-group");i.find(".file-item").tooltip("destroy").end().text(n.attr("placeholder")||""),n.find("input:file").val("")}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).on("show.bs.popover",function(){t(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find('.af-statebar-area [data-toggle="popover"]').popover({html:1,trigger:"manual",placement:"top",content:'<div class="input-group" style="min-width:150px"></div>'}).on("inserted.bs.popover",function(){var e=t(this),a=e.data("bs.popover").tip().find(".popover-content"),i=e.attr("data-type")||"";if("components"==i){if(AF_EDITOR_COMPONENTS){var n='<div class="list-group" style="margin:0">';for(var o in AF_EDITOR_COMPONENTS)n=n+'<a href="#" class="list-group-item" data-name="'+AF_EDITOR_COMPONENTS[o][0]+'">'+AF_EDITOR_COMPONENTS[o][1]+"</a>";a.attr("style","padding:0").find(".input-group").html(n+"</div>").find("a").click(function(){var e=t(this).attr("data-name");return pop_win(request_uri+"module/editor/component.php?n="+e+"&k="+r.options.name,null,null,"af_editor_components"),!1})}}else a.find(".input-group").html('<input type="text" class="form-control" style="width:150px" placeholder="Link"><a href="#" class="btn btn-default input-group-addon">OK</a>').find("a").click(function(){var e=t(this).prev().val()||"";return r.exec(i,e),!1})}).on("shown.bs.popover",function(){var e=t(this),a=e.data("bs.popover").tip().find(".popover-content").find("input");a.length>0?a.focus().select():a=e,a.on("blur",function(){e.popover("hide")})}).on("click",function(){t(this).popover("toggle")}),this.$element.find(".uploader-group .file-item").each(function(){a(t(this))});var s=this.$element.find("iframe");s.length&&s.remove(),this.options.html&&this.switch(!0)}i.VERSION="1.0.0",i.DEFAULTS={required:!1,readonly:!1,html:!1},i.prototype.switch=function(a){var i=this,n=this.$textarea,o=this.$element.find("iframe"),r=n.css("height")||"",s=this.options.readonly;if(a)o.length||(o=t('<iframe class="form-control vresize">').on("load",function(){var a=t(this);a.contents().find("body").on("dragover",function(t){t.preventDefault()}).on("drop",function(t){t.preventDefault(),e(t,i)}),a.contents().find("head").html('<link rel="stylesheet" href="'+request_uri+'module/editor/editor.min.css">'),a.contents().find("body").html(n.val()),a.contents().on("keydown",function(t){if(13==t.keyCode)return i.paste("<br>",!1),!1}),s||(a.contents()[0].designMode="on")}).insertAfter(n.hide()).end(),s?o.attr("readonly","readonly"):o.removeAttr("readonly")),o.css("height",r);else{var l;o.length?(r=o.css("height"),l=o.contents().find("body").html(),o.remove()):l=n.val(),n.css("height",r).val(l).show(),s?n.attr("readonly","readonly"):n.removeAttr("readonly")}},i.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))},i.prototype.paste=function(e,a){var i,n=this.$textarea;if(a=!1!==a,n.is(":visible")&&0!==n.length||(n=this.$element.find("iframe")),"TEXTAREA"==n[0].tagName){n.focus();var o=n.prop("selectionStart"),r=n.prop("selectionEnd"),s=n.val(),l=s.substring(0,o),c=s.substring(o+(r-o),s.length),d=s.substring(o,r);a&&(e=e.replace(/%s/,d)),n.val(l+e+c),r=r+e.length-d.length,n[0].setSelectionRange?n[0].setSelectionRange(o,r):n[0].createTextRange&&((i=n[0].createTextRange()).collapse(!0),i.moveEnd("character",r),i.moveStart("character",o),i.select()),n.focus()}else{n.contents().find("body").focus();var p,f=!1,h=n[0].contentWindow;if(h){if(h.getSelection)p=h.getSelection();else if(h.document.getSelection)p=h.document.getSelection();else{if(!(p=h.document.selection&&h.document.selection.createRange()).text)return!1;f=!0}if(f)a&&(e=e.replace(/%s/,p.text)),p.pasteHTML(e);else if(p.getRangeAt&&p.rangeCount){i=p.getRangeAt(0);var u=h.document.createElement("div");u.appendChild(i.cloneContents()),a&&(e=e.replace(/%s/,u.innerText)),i.deleteContents(),i.insertNode(t(e)[0]),a||(i.setStart(p.focusNode,p.focusOffset),i.setEnd(p.anchorNode,p.anchorOffset))}}n.contents().find("body").focus()}},i.prototype.exec=function(t,e){var a,i=this.$textarea;switch(i.is(":visible")&&0!==i.length||(i=this.$element.find("iframe")),t){case"bold":case"italic":case"strikeThrough":case"insertorderedlist":if("TEXTAREA"==i[0].tagName)switch(t){case"bold":this.paste("**%s**");break;case"italic":this.paste("`%s`");break;case"strikeThrough":this.paste("~~%s~~");break;case"insertorderedlist":this.paste("\n1. %s\n2. ")}else i[0].contentWindow.document.execCommand(t,!1,e);break;case"header":this.paste("<h3>%s</h3>");break;case"indent":this.paste("<blockquote>%s</blockquote>");break;case"codeblock":this.paste("<pre><code>%s</code></pre>");break;case"link":var n=/https?:\/\/([a-z\.]*youtub?e?)\.(com|be)(\/embed\/|\/watch\?v\=|\/)([^\?\&]+)(.*)/i,o=e.getQuery("t")||e.getQuery("start");n.test(e)?a='<img class="afox_widget" widget="youtube" src="'+e.replace(n,'https://img.youtube.com/vi/$4/mqdefault.jpg" width="560" height="315" vid="$4')+'"'+(o?' time="'+o+'"':"")+">\n":(a='<a href="'+e+'" target="_blank">'+e+"</a>","TEXTAREA"==i[0].tagName&&(a="<"+e+">")),this.paste(a,!1)}"TEXTAREA"==i[0].tagName?i.focus():i.contents().find("body").focus()};var n=t.fn.afEditor;t.fn.afEditor=function(e){return this.each(function(){var a=t(this),n=a.data("af.editor"),o="object"==typeof e&&e;n||a.data("af.editor",n=new i(this,o)),"string"==typeof e&&n[e]()}).data("af.editor")},t.fn.afEditor.Constructor=i,t.fn.afEditor.noConflict=function(){return t.fn.afEditor=n,this}}(jQuery);