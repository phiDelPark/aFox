if("undefined"==typeof jQuery)throw document.getElementById("def-jQuery-JS")||parent.location.replace(request_uri+"?cdnerr=jquery"),new Error("aFox's JavaScript requires jQuery");if(void 0===$("body").alert)throw document.getElementById("def-Bootstrap-JS")||parent.location.replace(request_uri+"?cdnerr=bootstrap"),new Error("aFox's JavaScript requires Bootstrap");var $_LANG={};!function(e){"use strict";jQuery.fn.offOn=function(e,t,r,a){return this.off(e,"function"==typeof t?void 0:t).on(e,t,r,a)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.sprintf=function(){var e=this,t=arguments;t=1===t.length&&"object"==typeof t[0]?t[0]:t;for(var r=0,a=t.length;r<a;r++)e=e.replace(/%([0-9]?)(s|d)/,(function(e,a,n){var i=t[r]+"";if(Number(a||0)>0)for(var o="d"==n?"0":"_";i.length<a;)i=o+i;return i}));return e},String.prototype.toUcFirst=function(){var e=this.toLowerCase();return e.charAt(0).toUpperCase()+e.slice(1)},String.prototype.nl2br=function(e="<br>"){return this.replace(/\r\n|\n\r|\r|\n/g,e)},String.prototype.stripTags=function(e){e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return this.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(t,r){return e.indexOf("<"+r.toLowerCase()+">")>-1?t:""}))},String.prototype.escapeMKDW=function(e){var t=!1===e?/[\`\[\]]/g:/[\\\`\*\_\{\}\[\]\(\)\>\#\+\-\.\!]/g;return this.replace(t,(function(e){return"\\"+e}))},String.prototype.escapeHtml=function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,(function(t){return e[t]}))},String.prototype.unescapeHtml=function(){var e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};return this.replace(/&[^;]+;/g,(function(t){return e[t]}))},String.prototype.getQuery=function(e){var t=decodeURIComponent(this).replace(/&amp;/g,"&"),r={};return t.replace(/[?&]+([^=&]+)=([^&]*)/g,(function(e,t,a){r[t]=a})),e?r[e]||"":r},String.prototype.setQuery=function(){var e=decodeURIComponent(this).replace(/&amp;/g,"&"),t=arguments,r=t.length;if(0===r)return e;"object"==typeof t[0]&&(r=(t=t[0]).length);for(var a,n=""!==t[0]?e.getQuery():{},i=[],o=""===t[0]?1:0;o<r;o+=2)n[t[o]]=t[o+1];for(var s in n)n.hasOwnProperty(s)&&(a=String(n[s]).trim())&&i.push(s+"="+a);var c=e.indexOf("?");return"/"!=(e=-1==c?e:e.substr(0,c)).substr(-1,1)&&(e+="/"),e+(i.length>0?"?"+i.join("&"):"")},Number.prototype.shortSize=function(){for(var e=this,t=0;t<4&&!(e<=1024);t++)e/=1024;return e.toFixed(1)+["B","K","M","G","T"][t]},Number.prototype.withCommas=function(){var e=String(this);return(0===e.indexOf("-")?"-":"")+(","==(e=e.replace(/[^0-9]/g,"").split("").reverse().join("").replace(/(.{3})/g,"$1,").split("").reverse().join("")).substring(0,1)?e.substring(1,e.length):e)},HTMLFormElement.prototype.dataExport=function(){var t,r,a={},n=e(this).serializeArray();for(var i in n){if(t=n[i].name,r=n[i].value,"[]"===t.substring(t.length-2)){var o=e('[name="'+t+'"]');(o.eq(0).is(":checkbox")||o.eq(0).is(":radio"))&&(o=e('[name="'+t+'"]:checked')),r=o.map((function(){return this.value})).get(),t=t.slice(0,-2)}a[t]=r}return a},HTMLFormElement.prototype.dataImport=function(t){var r,a,n;for(var i in t)if(n="",(r=e(this).find("[name="+i+"]")).is("input"))if(r.is(":file")){if((a=r.parent().parent().parent()).hasClass("uploader-group")){if(a.find("input:file").val(""),t[i])if(e.isArray(t[i]))for(var o in a.addClass("file-list").find("input:file").attr("multiple","1"),t[i])n+='<i class="file-item" title="'+o.title+'" data-type="'+o.type+'"></i>';else n='<i class="file-item">'+t[i]+"</i>";a.find(".file-caption").html(n||(a.attr("placeholder")||""))}}else r.is(":checkbox")?r[0].checked=1==t[i]:r.is(":radio")?r.filter((function(){return this.value===t[i]})).attr("checked","checked"):r.val("0"==t[i]?"":t[i]);else(r.is("select")||r.is("textarea"))&&r.val(t[i])},e.set_cookie=window.set_cookie=function(t,r,a){if(void 0!==e.md5&&(t=e.md5(t)),void 0!==e.base64&&(r=e.base64.encode(r)),a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),a="; expires="+n.toGMTString()}else a="";document.cookie=t+"="+encodeURIComponent(r)+a+"; path=/"},e.get_cookie=window.get_cookie=function(t){void 0!==e.md5&&(t=e.md5(t));var r=document.cookie.match(new RegExp(t+"=([^;]+)")),a=r?decodeURIComponent(r[1]):null;return null!==a&&void 0!==e.base64&&(a=e.base64.decode(a)),a},e.msg_box=window.msg_box=function(t,r,a,n){var i='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="afMsgBox" aria-hidden="true" style="z-index:99999"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" id="afMsgBox"><i class="glyphicon glyphicon-%s" aria-hidden="true"></i> %s</div><div class="modal-body"></div><div class="modal-footer">%s</div></div></div></div>',o={ok:$_LANG.ok||"Ok",cancel:$_LANG.cancel||"Cancel",yes:$_LANG.yes||"Yes",no:$_LANG.no||"No"},s='<button type="button" class="btn btn-default%s" data-key="%s">%s</button>',c=s.sprintf(' btn-primary" data-dismiss="modal',"ok",o.ok);if(r||(r=(e("title").text().split("-")||["Alert"])[0]),a&&a[1])for(var l in c="",a[1]){var d=a[1][l].toLowerCase();c+=s.sprintf(d.toUpperCase()===a[1][l]?" btn-primary":"",d,o[d])}i=i.sprintf({info:"info-sign",question:"question-sign",asterisk:"asterisk",warning:"exclamation-sign"}[a?a[0]:"warning"],r,c);var p=e(":focus"),u=e(i).find(".modal-body:eq(0)").html(t).end();return u.prependTo("body").offOn("show.bs.modal",(function(t){e.isFunction(n)&&n("show",u.find(".modal-body"))})).offOn("hide.bs.modal",(function(t){e.isFunction(n)&&n("hide",u.find(".modal-body"))})).offOn("shown.bs.modal",(function(t){e(this).find('.modal-body input[type!="hidden"]:eq(0)').focus()})).offOn("hidden.bs.modal",(function(t){e(this).remove(),p.focus()})).offOn("keydown",(function(t){13==t.which&&"TEXTAREA"!=t.target.tagName&&(t.preventDefault(),e(this).find(".modal-footer>button.btn-primary").click())})).modal("show").find(".modal-footer>button").offOn("click",(function(t){if(e.isFunction(n)){if(!n(e(this).attr("data-key"),u.find(".modal-body")))return!1;u.modal("hide")}})),!1},e.pop_win=window.pop_win=function(e,t,r,a){var n=window.open(e,a||"af_popup","width="+(t||"700")+",height="+(r||"500")+",top=50,left=50,scrollbars=yes,toolbar=no,menubar=no,location=no");return n.focus(),n},e.exec_ajax=window.exec_ajax=function(t,r,a,n){var i=e("string"==typeof t?"BODY":t),o=(("string"==typeof t?t:i.attr("data-exec-ajax"))||"").split(".");if(2==o.length&&!i.data("actioning")){i.data("actioning",!0);var s="FORM"==t.tagName,c="multipart/form-data"==(i.attr("enctype")||""),l=r||{},d=e('<div class="af_waiting_message alert alert-warning" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> '+($_LANG&&$_LANG.calling_server?$_LANG.calling_server:"Please wait...")+'<div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" style="width:100%"></div></div></div>');if(d.hide().appendTo("body").fadeIn(1500),(void 0===n||n.length<1)&&(n=[]),s&&c)(l=new FormData(i[0])).append("module",o[0]),l.append("act",o[1]),l.append("response_tags",n);else{if(s)l=i[0].dataExport();else{var p=(i.attr("data-ajax-param")||"").split(",");if(p.length>1)for(var u=0,f=p.length;u<f;u+=2)l[p[u]]=p[u+1]}e.extend(l,{module:o[0],act:o[1],response_tags:n}),l=JSON.stringify(l)}try{e.ajax({type:"POST",url:request_uri,dataType:!c&&"json",contentType:!c&&"application/json",processData:!c,data:l,beforeSend:function(t,r){var n=!1;if(e.isFunction(a))n=!1===a("before",r,t);else{var o=e.Event("before.exec.ajax");i.trigger(o,[r,t]),n=o.isDefaultPrevented()}if(n)return d.remove(),i.data("actioning",!1),!1},complete:function(t,r){i.data("actioning",!1),e.isFunction(a)?a("complete",r,t):i.trigger("complete.exec.ajax",[r,t]),d.remove()},success:function(t,r,n){var o,s=!1;"string"==typeof t?((t=[]).error="1",t.message=n.responseText.replace(/<[^>]+>/g,"")):(t.error||(t.error="0"),t.message||(t.message="")),i.data("actioning",!1);var c="0"!==t.error;e.isFunction(a)?s=!1===a(c?"error":"success",t,n):(o=e.Event(c?"error.exec.ajax":"success.exec.ajax"),i.trigger(o,[t,n]),s=o.isDefaultPrevented()),s||(c&&alert(t.message.replace(/<br[\s|\/]*>/g,"\n")),t.redirect_url&&parent.location.replace(t.redirect_url))},error:function(t,r,n){var o=r,s=!1;"parsererror"==r?(o="The result is not valid JSON :\n--------------------------------\n",""!==t.responseText&&(o+=t.responseText.replace(/<[^>]+>/g,"")),o="parsererror"):o=n;var c=[];if(c.error="1",c.message=o,i.data("actioning",!1),e.isFunction(a))s=!1===a("error",c,t);else{var l=e.Event("error.exec.ajax");i.trigger(l,[c,t]),s=l.isDefaultPrevented()}s||(alert(c.message.replace(/<br[\s|\/]*>/g,"\n")),c.redirect_url&&parent.location.replace(c.redirect_url))}})}catch(e){alert(e),d.remove(),i.data("actioning",!1)}}},e(document).on("click","[data-msg-box]",(function(t){var r=e(this);if(!0===r.data("clicked"))return!0;t.stopImmediatePropagation();var a=r.attr("data-msg-box")||"warning",n=r.attr("data-title")||r.attr("title")||"";return msg_box(n,"",[a,"question"==a?["OK","cancel"]:["OK"]],(function(e){if("question"==a&&"ok"==e){r.data("clicked",!0);var t=document.createEvent("MouseEvents");t.initEvent("click",!1,!0),r[0].dispatchEvent(t)}return!0})),!1})).on("click","[data-exec-ajax][data-ajax-param]",(function(t){var r=e(this);if(e(t.target).is("[data-except-ajax]"))return!0;var a=r.attr("data-ajax-confirm")||"";return t.preventDefault(),""!=a?msg_box(a,"",["question",["OK","cancel"]],(function(e){return"ok"==e&&exec_ajax(r),!0})):exec_ajax(this),!1})).on("submit","form[data-exec-ajax]",(function(t){var r=e(this).attr("data-ajax-confirm")||"";return t.preventDefault(),""!=r?msg_box(r,"",["question",["OK","cancel"]],(function(e){return"ok"==e&&exec_ajax($this),!0})):exec_ajax(this),!1})),e(document).on("change",".uploader-group input:file",(function(t){var r=e(this),a=r.closest(".uploader-group"),n=a.find(".file-caption"),i=r[0].hasAttribute("multiple");i&&a.addClass("file-list");var o=e.Event("insert.af.uploader");a.trigger(o,[r.prop("files")]),o.isDefaultPrevented()||(n.html(""),e.map(r.prop("files"),(function(t,r){var a=(t.type.split("/")[0]||"binary").escapeHtml(),o=t.size.shortSize(),s=t.name.escapeHtml()+" ("+o+")";e('<i class="file-item" title="'+(i?s:"")+'" data-type="'+a+'" data-index="'+r+'">').html(i?"":s).appendTo(n)})))})).on("click",".uploader-group .file-caption",(function(t){var r=e(this),a=r.find(".file-item"),n=r.closest(".uploader-group"),i=n.find("input:file"),o=n.attr("placeholder")||"";if(a.length>0){var s=e.Event("delete.af.uploader");if(n.trigger(s,[i.prop("files")]),s.isDefaultPrevented())return;i.val(""),e('<input type="hidden" name="remove_files[]" value="'+i.attr("name")+'">').appendTo(r.text(o))}})).on("keydown",".uploader-group .file-caption",(function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).click())})).on("keydown",".uploader-group .btn-file",(function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).find("input:file").click())})).on("uploader:repair",".uploader-group",(function(t){var r=e(this),a=r.find("input:hidden"),n=r.find(".file-caption"),i=r.attr("placeholder")||"";!n.find(".file-item").length&&i&&n.text(i),n[0]&&!n[0].hasAttribute("tabindex")&&n.attr("tabindex","0"),a[0]&&!a[0].hasAttribute("tabindex")&&(a.parent().attr("tabindex","0"),a.attr("tabindex","-1"))})),e(document).on("keydown","label.checkbox,label.radio",(function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).find(">input").click())})),e(document).on("keyup","input[maxbyte],textarea[maxbyte]",(function(t){var r=e(this),a=r.attr("maxbyte")||0;if(!isNaN(a)){for(var n,i=0,o="",s=r.val(),c=0;!isNaN(n=s.charCodeAt(c))&&!((i+=n<128?1:n<2048?2:n<3936256?3:4)>a);c++)o+=String.fromCharCode(n);r.val(o)}})),e(window).on("load",(function(){e(".uploader-group").trigger("uploader:repair")}))}(jQuery);