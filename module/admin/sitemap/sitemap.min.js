let siteMap_tempKey=-1;function SiteMap(e){const t=document.querySelector(e);let n=!1,o={x:0,y:0},r={top:0,left:0,right:0,bottom:0},l=[],a=null,s=null,i=null,p=null;const c=(e,t)=>{let n=0,o=0;for(;e&&e!=t;)n+=e.offsetTop,o+=e.offsetLeft,e=e.offsetParent;return{top:n,left:o}},u=(e,t)=>{if(Math.abs(e.top-t)<=4)return p.style.top=e.top-4+"px",p.style.height="8px","before";if(Math.abs(e.bottom-t)<=4)return p.style.top=e.bottom-4+"px",p.style.height="8px","after";{const t=s.firstChild.nextSibling;return p.style.top=e.top+1+"px",p.style.height=(t.offsetHeight||48)+8+"px","prepend"}},d=e=>{let t,n,s,c,d="LI"!=e.target.tagName?e.target.closest("LI"):e.target;if(!d||"LI"!=d.tagName)return!1;a=null,t={x:o.x-e.pageX,y:o.y-e.pageY},n=r.top-t.y;for(let e=0,t=l.length;e<t;e++){if(c=n,s=l[e],0===e&&c<s.top&&(c=s.top),e==t-1&&c>s.bottom&&(c=s.bottom),s.top<=c&&s.bottom>=c){a={element:s.item,state:u(s,c)},p.style.opacity=.6;break}p.style.opacity=0}return i.style.display="block",i.style.top=n+"px",!1},m=e=>{if(n=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",m),s.style.opacity="1",i.remove(),p.remove(),!a)return!1;let t="LI"!=a.element.tagName?a.element.closest("LI"):a.element;try{switch(a.state){case"after":t.after(s);break;case"before":t.before(s);break;case"prepend":let e=a.element.querySelector("UL"),n=a.element,o=0;for(;"LI"==n?.tagName||"UL"==n?.tagName;)"UL"==n?.tagName&&o++,n=n.parentNode;o<5&&(e||(e=document.createElement("ul"),a.element.append(e)),e.append(s));break}let e=s.querySelector('input[name="parent_key[]"]'),n=s.parentNode.closest("LI");e.value=n?.querySelector('input[name="item_key[]"]').value||"0"}catch(e){}return!1};t.addEventListener("mousedown",(e=>{if(["UL","INPUT","TEXTAREA"].indexOf(e.target.tagName)>-1||1!=e.which)return;n=!0,s="LI"!=e.target.tagName?e.target.closest("LI"):e.target,s.style.opacity=".5",i=s.cloneNode(!0),i.classList.add("draggable"),p=document.createElement("li"),p.classList.add("placeholder");const a=t.querySelectorAll("LI"),u=s.getBoundingClientRect();t.append(i),t.append(p);const f=s.firstChild.nextSibling.offsetHeight;return l=[],a.forEach((e=>{let n=c(e,t);l.push({top:n.top,bottom:n.top+f,item:e})})),r=c(s,t),o={x:e.pageX,y:e.pageY},i.style.cssText=`\n\t\t\tdisplay: none;\n\t\t\tposition: absolute;\n\t\t\topacity: .4;\n\t\t\twidth: ${u.width}px;\n\t\t\theight: ${u.height}px;\n\t\t\tleft: ${r.left}px;\n\t\t\ttop: ${r.top}px;\n\t\t\tz-index: 100;\n\t\t\tpointer-events: none;\n\t\t`,p.style.cssText=`\n\t\t\tposition: absolute;\n\t\t\topacity: 0;\n\t\t\theight: 8px;\n\t\t\tmin-height: 8px;\n\t\t\twidth: ${u.width}px;\n\t\t\tleft: ${r.left}px;\n\t\t\ttop: ${r.top}px;\n\t\t\tz-index: 99;\n\t\t\tpointer-events: none;\n\t\t`,document.addEventListener("mousemove",d),document.addEventListener("mouseup",m),!1})),t.addEventListener("mouseover",(e=>!1)),t.addEventListener("mouseout",(e=>!1));t.querySelectorAll("li input[value=delete]").forEach((e=>{e.addEventListener("click",(e=>{if(e.preventDefault(),!confirm($_LANG.confirm_delete.sprintf([$_LANG.menu])))return;("LI"!=e.target.tagName?e.target.closest("LI"):e.target).remove()}))}));t.querySelectorAll("li input[value=setup]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const n=e.closest("LI"),o=n.querySelector(".input"),r=n.querySelector(".setup");o.classList.toggle("d-none"),r.classList.toggle("d-none")}))}));t.closest("FORM").addEventListener("submit",(e=>{try{return e.target.querySelectorAll("input[type=checkbox]").forEach((e=>{e.checked&&(e.value=1),e.setAttribute("type","hidden")})),!0}catch(t){return e.preventDefault(),!1}}))}window.onload=function(){window.siteMapItemAdd=(e,t)=>{try{const e=document.querySelector("#siteMapRoot"+t),n=document.querySelector("#siteMap_item_template li").cloneNode(!0),o=n.querySelector("input[value=delete]"),r=n.querySelector("input[value=setup]");n.querySelector('input[name="item_key[]"]').value=siteMap_tempKey--,o.addEventListener("click",(e=>{if(e.preventDefault(),!confirm($_LANG.confirm_delete.sprintf([$_LANG.menu])))return;("LI"!=e.target.tagName?e.target.closest("LI"):e.target).remove()})),r.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest("LI"),n=t.querySelector(".input"),o=t.querySelector(".setup");n.classList.toggle("d-none"),o.classList.toggle("d-none")})),e.prepend(n)}catch(e){}return!1};new SiteMap("#siteMapRoot1"),new SiteMap("#siteMapRoot2")};