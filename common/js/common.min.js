if("undefined"==typeof jQuery)throw document.getElementById("def-jQuery-JS")||parent.location.replace(request_uri+"?cdnerr=jquery"),new Error("aFox's JavaScript requires jQuery");if(void 0===$("body").alert)throw document.getElementById("def-Bootstrap-JS")||parent.location.replace(request_uri+"?cdnerr=bootstrap"),new Error("aFox's JavaScript requires Bootstrap");var $_LANG={};!function(e){"use strict";jQuery.fn.offOn=function(e,t,r,a){return this.off(e,"function"==typeof t?void 0:t).on(e,t,r,a)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toUcFirst=function(){var e=this.toLowerCase();return e.charAt(0).toUpperCase()+e.slice(1)},String.prototype.sprintf=function(){for(var e=this,t=arguments,r=0,a=(t=1===t.length&&"object"==typeof t[0]?t[0]:t).length;r<a;r++)e=e.replace(/%([0-9]?)(s|d)/,function(e,a,i){var n=t[r]+"";if(Number(a||0)>0)for(var o="d"==i?"0":"_";n.length<a;)n=o+n;return n});return e},String.prototype.stripTags=function(e){e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return this.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,r){return e.indexOf("<"+r.toLowerCase()+">")>-1?t:""})},String.prototype.escapeMKDW=function(e){var t=!1===e?/[\`\[\]]/g:/[\\\`\*\_\{\}\[\]\(\)\>\#\+\-\.\!]/g;return this.replace(t,function(e){return"\\"+e})},String.prototype.escapeHtml=function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(t){return e[t]})},String.prototype.getQuery=function(e){var t={};return decodeURIComponent(this).replace(/&amp;/g,"&").replace(/[?&]+([^=&]+)=([^&]*)/g,function(e,r,a){t[r]=a}),e?t[e]||"":t},String.prototype.setQuery=function(){var e=decodeURIComponent(this).replace(/&amp;/g,"&"),t=arguments,r=t.length;if(0===r)return e;"object"==typeof t[0]&&(r=(t=t[0]).length);for(var a,i=""!==t[0]?e.getQuery():{},n=[],o=""===t[0]?1:0;o<r;o+=2)i[t[o]]=t[o+1];for(var s in i)i.hasOwnProperty(s)&&(a=String(i[s]).trim())&&n.push(s+"="+a);var l=e.indexOf("?");return"/"!=(e=-1==l?e:e.substr(0,l)).substr(-1,1)&&(e+="/"),e+(n.length>0?"?"+n.join("&"):"")},Number.prototype.shortFileSize=function(){for(var e=this,t=0;t<4&&!(e<=1024);t++)e/=1024;return e.toFixed(1)+["B","KB","MB","GB"][t]},Number.prototype.withCommas=function(){var e=String(this),t=0===e.indexOf("-");return e=e.replace(/[^0-9]/g,"").split("").reverse().join("").replace(/(.{3})/g,"$1,").split("").reverse().join(""),(t?"-":"")+(","==e.substring(0,1)?e.substring(1,e.length):e)},HTMLFormElement.prototype.dataExport=function(){var t,r,a={},i=e(this).serializeArray();for(var n in i){if(t=i[n].name,r=i[n].value,"[]"===t.substring(t.length-2)){var o=e('[name="'+t+'"]');(o.eq(0).is(":checkbox")||o.eq(0).is(":radio"))&&(o=e('[name="'+t+'"]:checked')),r=o.map(function(){return this.value}).get(),t=t.slice(0,-2)}a[t]=r}return a},HTMLFormElement.prototype.dataImport=function(t){var r,a,i;for(var n in t)if(i="",(r=e(this).find("[name="+n+"]")).is("input"))if(r.is(":file")){if((a=r.parent().parent().parent()).hasClass("uploader-group")){if(a.find("input:file").val(""),t[n])if(e.isArray(t[n]))for(var o in a.addClass("file-list").find("input:file").attr("multiple","1"),t[n])i+='<i class="file-item" title="'+o.title+'" data-type="'+o.type+'"></i>';else i='<i class="file-item">'+t[n]+"</i>";a.find(".file-caption").html(i||(a.attr("placeholder")||""))}}else r.is(":checkbox")?r[0].checked=1==t[n]:r.is(":radio")?r.filter(function(){return this.value===t[n]}).attr("checked","checked"):r.val("0"==t[n]?"":t[n]);else(r.is("select")||r.is("textarea"))&&r.val(t[n]);var s=e(this).find(".af-editor-group");if(s.length>0){s.find(".af-editor-toolbar input:hidden").each(function(){var t=e(this),r=t.closest(".af-editor-toolbar"),a=t.attr("name"),i=t.val();r.find('[data-target="'+a+'"]').find(".glyphicon").addClass("glyphicon-unchecked").removeClass("glyphicon-check"),r.find('[data-target="'+a+'"][data-value="'+i+'"]').find(".glyphicon").addClass("glyphicon-check").removeClass("glyphicon-unchecked")});var l=s.find('[name="upload_files[]"]');l.length>0&&e.isArray(t.files)&&t.files.length>0&&(i='<div class="form-group has-feedback" style="margin-bottom:5px"><div class="af-editor-uploaded uploader-group file-list form-control" style="margin-top:10px">',e.map(t.files,function(e,t){i+='<i class="file-item" draggable="true" title="'+e.mf_name.escapeHtml()+" ("+Number(e.mf_size).shortFileSize()+')" data-type="'+e.mf_type+'" data-srl="'+e.mf_srl+'"></i>'}),i+='</div><span class="glyphicon glyphicon-question-sign form-control-feedback" style="pointer-events:auto;cursor:pointer" tabindex="0"></span></div>',l.closest(".af-editor-uploader").prepend(i))}},e.set_cookie=window.set_cookie=function(t,r,a){if(void 0!==e.md5&&(t=e.md5(t)),void 0!==e.base64&&(r=e.base64.encode(r)),a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),a="; expires="+i.toGMTString()}else a="";document.cookie=t+"="+encodeURIComponent(r)+a+"; path=/"},e.get_cookie=window.get_cookie=function(t){void 0!==e.md5&&(t=e.md5(t));var r=document.cookie.match(new RegExp(t+"=([^;]+)")),a=r?decodeURIComponent(r[1]):null;return null!==a&&void 0!==e.base64&&(a=e.base64.decode(a)),a},e.msg_box=window.msg_box=function(t,r,a,i){var n='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="afMsgBox" aria-hidden="true" style="z-index:99999"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" id="afMsgBox"><i class="glyphicon glyphicon-%s" aria-hidden="true"></i> %s</div><div class="modal-body"></div><div class="modal-footer">%s</div></div></div></div>',o={ok:$_LANG.ok||"Ok",cancel:$_LANG.cancel||"Cancel",yes:$_LANG.yes||"Yes",no:$_LANG.no||"No"},s='<button type="button" class="btn btn-default%s" data-key="%s">%s</button>',l=s.sprintf(' btn-primary" data-dismiss="modal',"ok",o.ok);if(r||(r=(e("title").text().split("-")||["Alert"])[0]),a&&a[1])for(var d in l="",a[1]){var c=a[1][d].toLowerCase();l+=s.sprintf(c.toUpperCase()===a[1][d]?" btn-primary":"",c,o[c])}n=n.sprintf({info:"info-sign",question:"question-sign",asterisk:"asterisk",warning:"exclamation-sign"}[a?a[0]:"warning"],r,l);var p=e(n).find(".modal-body:eq(0)").html(t).end();return p.prependTo("body").offOn("show.bs.modal",function(t){e.isFunction(i)&&i("show",p.find(".modal-body"))}).offOn("hide.bs.modal",function(t){e.isFunction(i)&&i("hide",p.find(".modal-body"))}).offOn("shown.bs.modal",function(t){e(this).find('.modal-body input[type!="hidden"]:eq(0)').focus()}).offOn("hidden.bs.modal",function(t){e(this).remove()}).offOn("keydown",function(t){13==t.which&&"TEXTAREA"!=t.target.tagName&&(t.preventDefault(),e(this).find(".modal-footer>button.btn-primary").click())}).modal("show").find(".modal-footer>button").offOn("click",function(t){if(e.isFunction(i)){if(!i(e(this).attr("data-key"),p.find(".modal-body")))return!1;p.modal("hide")}}),!1},e.pop_win=window.pop_win=function(e,t,r,a){var i=window.open(e,a||"af_popup","width="+(t||"700")+",height="+(r||"500")+",top=50,left=50,scrollbars=yes,toolbar=no,menubar=no,location=no");return i.focus(),i},e.exec_ajax=window.exec_ajax=function(t,r,a,i){var n=e("string"==typeof t?"BODY":t),o=(("string"==typeof t?t:n.attr("data-exec-ajax"))||"").split(".");if(2==o.length&&!n.data("actioning")){n.data("actioning",!0);var s="FORM"==t.tagName,l="multipart/form-data"==(n.attr("enctype")||""),d=r||{},c=e('<div class="af_waiting_message alert alert-warning" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> '+($_LANG&&$_LANG.calling_server?$_LANG.calling_server:"Please wait...")+'<div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" style="width:100%"></div></div></div>');if(c.hide().appendTo("body").fadeIn(1500),(void 0===i||i.length<1)&&(i=[]),s&&l)(d=new FormData(n[0])).append("module",o[0]),d.append("act",o[1]),d.append("response_tags",i);else{if(s)d=n[0].dataExport();else{var p=(n.attr("data-ajax-param")||"").split(",");if(p.length>1)for(var f=0,u=p.length;f<u;f+=2)d[p[f]]=p[f+1]}e.extend(d,{module:o[0],act:o[1],response_tags:i}),d=JSON.stringify(d)}try{e.ajax({type:"POST",url:request_uri,dataType:!l&&"json",contentType:!l&&"application/json",processData:!l,data:d,beforeSend:function(t,r){var i=!1;if(e.isFunction(a))i=!1===a("before",r,t);else{var o=e.Event("before.exec.ajax");n.trigger(o,[r,t]),i=o.isDefaultPrevented()}if(i)return c.remove(),n.data("actioning",!1),!1},complete:function(t,r){n.data("actioning",!1),e.isFunction(a)?a("complete",r,t):n.trigger("complete.exec.ajax",[r,t]),c.remove()},success:function(t,r,i){var o,s=!1;"string"==typeof t?((t=[]).error="1",t.message=i.responseText.replace(/<[^>]+>/g,"")):(t.error||(t.error="0"),t.message||(t.message="")),n.data("actioning",!1);var l="0"!==t.error;e.isFunction(a)?s=!1===a(l?"error":"success",t,i):(o=e.Event(l?"error.exec.ajax":"success.exec.ajax"),n.trigger(o,[t,i]),s=o.isDefaultPrevented()),s||(l&&alert(t.message.replace(/<br[\s|\/]*>/g,"\n")),t.redirect_url&&parent.location.replace(t.redirect_url))},error:function(t,r,i){var o=r,s=!1;"parsererror"==r?(o="The result is not valid JSON :\n--------------------------------\n",""!==t.responseText&&(o+=t.responseText.replace(/<[^>]+>/g,"")),console.log(o),o="parsererror"):o=i;var l=[];if(l.error="1",l.message=o,n.data("actioning",!1),e.isFunction(a))s=!1===a("error",l,t);else{var d=e.Event("error.exec.ajax");n.trigger(d,[l,t]),s=d.isDefaultPrevented()}s||(alert(l.message.replace(/<br[\s|\/]*>/g,"\n")),l.redirect_url&&parent.location.replace(l.redirect_url))}})}catch(e){alert(e),c.remove(),n.data("actioning",!1)}}},e(document).on("submit","form[data-exec-ajax]",function(t){var r=e(this).attr("data-ajax-confirm")||"";return t.preventDefault(),r&&!0!==confirm(r)||exec_ajax(this),!1}).on("click","[data-exec-ajax][data-ajax-param]",function(t){var r=e(t.target);if(r.is("[except-exec-event]"))return!0;if(void 0===r.data("clicked")||!0===r.data("clicked")){var a=e(this).attr("data-ajax-confirm")||"";t.preventDefault(),a&&!0!==confirm(a)||exec_ajax(this)}return!1}),e(document).on("change",".uploader-group input:file",function(t){var r=e(this),a=r.closest(".uploader-group"),i=a.find(".file-caption"),n=r[0].hasAttribute("multiple");n&&a.addClass("file-list");var o=e.Event("insert.af.uploader");a.trigger(o,[r.prop("files")]),o.isDefaultPrevented()||(i.html(""),e.map(r.prop("files"),function(t,r){var a=(t.type.split("/")[0]||"binary").escapeHtml(),o=t.size.shortFileSize(),s=t.name.escapeHtml()+" ("+o+")";e('<i class="file-item" title="'+(n?s:"")+'" data-type="'+a+'" data-index="'+r+'">').html(n?"":s).appendTo(i)}))}).on("click",".uploader-group .file-caption",function(t){var r=e(this),a=r.find(".file-item"),i=r.closest(".uploader-group"),n=i.find("input:file"),o=i.attr("placeholder")||"";if(a.length>0){var s=e.Event("delete.af.uploader");if(i.trigger(s,[n.prop("files")]),s.isDefaultPrevented())return;n.val(""),e('<input type="hidden" name="remove_files[]" value="'+n.attr("name")+'">').appendTo(r.text(o))}}).on("keydown",".uploader-group .file-caption",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).click())}).on("keydown",".uploader-group .btn-file",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).find("input:file").click())}).on("uploader:repair",".uploader-group",function(t){var r=e(this),a=r.find("input:hidden"),i=r.find(".file-caption"),n=r.attr("placeholder")||"";!i.find(".file-item").length&&n&&i.text(n),i[0]&&!i[0].hasAttribute("tabindex")&&i.attr("tabindex","0"),a[0]&&!a[0].hasAttribute("tabindex")&&(a.parent().attr("tabindex","0"),a.attr("tabindex","-1"))}),e(document).on("keydown","label.checkbox,label.radio",function(t){13!=t.which&&32!=t.which||(t.preventDefault(),e(this).find(">input").click())}),e(document).on("keyup","input[maxbyte],textarea[maxbyte]",function(t){var r=e(this),a=r.attr("maxbyte")||0;if(!isNaN(a)){for(var i,n=0,o="",s=r.val(),l=0;!isNaN(i=s.charCodeAt(l))&&!((n+=i<128?1:i<2048?2:i<3936256?3:4)>a);l++)o+=String.fromCharCode(i);r.val(o)}}),e(window).on("load",function(){e(".uploader-group").trigger("uploader:repair")})}(jQuery);