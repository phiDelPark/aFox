!function(a){"use strict";function b(a,b){var d,e=JSON.parse(a.originalEvent.dataTransfer.getData("TEXT")||"{}"),f=e.title,g=e.srl||e.index,h=e.srl?request_uri+"?file="+g:"af-editor-tmpfile="+g,i=e.type.split("/")[0]||"binary";if("TEXTAREA"==b[0].tagName){switch(f=f.escapeMKDW(!1),i){case"image":d="!["+f+"]("+h+")";break;case"video":case"audio":d="["+f+"]("+h+' "_'+e.type+'_")';break;default:d="[`"+f+"`]("+h+")"}c(d,"","",b),b.focus()}else{switch(f=f.escapeHtml(),h=e.path?e.path+'" data-af-editor-tmpfile="'+g:h.escapeHtml(),i){case"image":d='<img src="'+h+'" alt="'+f+'">';break;case"video":case"audio":d="<"+i+' width="100%" controls>',d+='<source src="'+h+'" type="'+e.type+'">',d+="Your browser does not support the audio element.</"+i+">";break;default:d='<a href="'+h+'"><code>'+f+"</code></a>"}c(d,"","",b),b.contents().find("body").focus()}}function c(b,c,d,e){var f;if("TEXTAREA"==e[0].tagName){var g=e.prop("selectionStart"),h=e.prop("selectionEnd"),i=e.val(),j=i.substring(0,g),k=i.substring(g+(h-g),i.length),l=i.substring(g,h);e.val(j+b+(l||d)+c+k),h=h+b.length+c.length,e[0].setSelectionRange?e[0].setSelectionRange(g,h):e[0].createTextRange&&(f=e[0].createTextRange(),f.collapse(!0),f.moveEnd("character",h),f.moveStart("character",g),f.select())}else{var m,n=!1,o=e[0].contentWindow;if(o){if(o.getSelection)m=o.getSelection();else if(o.document.getSelection)m=o.document.getSelection();else{if(m=o.document.selection&&o.document.selection.createRange(),!m.text)return!1;n=!0}if(n)m.pasteHTML(b+(m.text?m.text:d)+c);else if(m.getRangeAt&&m.rangeCount){f=m.getRangeAt(0);var p=o.document.createElement("div");p.appendChild(f.cloneContents()),p=a(b+(p.innerText?p.innerText:d)+c)[0],f.deleteContents(),f.insertNode(p)}}}}function d(a,b,d){var e="",f="";switch(a){case"bold":e="**",f="**";break;case"italic":e="`",f="`";break;case"underline":e="~~",f="~~";break;case"header":e="\n### ";break;case"insertorderedlist":e="\n1. ",f="\n2. ";break;case"indent":e="\n> ",f="";break;case"codeblock":e="\n```\n",f="\n```\n";break;case"link":e="<"+b+">",f="";break;case"video":var g=b.getQuery("t")||b.getQuery("start");e='<img class="afox_widget" widget="youtube" src="'+b.replace(/https?:\/\/([a-z\.]*youtub?e?)\.(com|be)(\/embed\/|\/watch\?v\=|\/)([^\?\&]+)(.*)/i,'https://img.youtube.com/vi/$4/mqdefault.jpg" width="560" height="315" vid="$4')+'"'+(g?' time="'+g+'"':"")+">\n",f=""}(e||f)&&c(e,f,"",d),d.focus()}function e(a,b,e){var f,g="",h="";switch(a){case"bold":case"italic":case"underline":case"insertorderedlist":f=e[0].contentWindow.document,f.execCommand(a,!1,b);break;case"header":g="<h3>",h="</h3>",c(g,h,"&nbsp;",e);break;case"indent":g="<blockquote>",h="</blockquote>",c(g,h,"&nbsp;",e);break;case"codeblock":g="<pre><code>",h="</code></pre>",c(g,h,"&nbsp;",e);break;case"link":g='<a href="'+b+'" target="_blank">',h="</a>",c(g,h,b,e);break;case"video":d("video",b,e)}e.contents().find("body").focus()}function f(a){var b=a.attr("title");if(a.removeAttr("title"),a.attr("data-title",b),"image"!==a.attr("data-type").substring(0,5))a.tooltip({container:"body"});else{var c=a.attr("data-srl")?request_uri+"?file="+a.attr("data-srl"):a.attr("data-path");b=b.substring(b.length-12,b.length),a.tooltip({html:1,container:"body",title:function(){return'<img src="'+c+'" style="width:80px;height:80px"><div style="width:80px;overflow:hidden;white-space:nowrap;">'+b+"</div>"}})}}function g(c,h){this.$element=a(c),this.$textarea=a(c).find("textarea").show(),this.options=a.extend({},g.DEFAULTS,h);var i=this;this.$element.closest("form").on("submit",function(){var a=i.$textarea.val(),b=i.$element.find("iframe");if(b.length&&(a=b.contents().find("body").html(),i.$textarea.val(a)),i.options.required&&!a)return alert(i.options.required),!1}),this.$element.on("click",".af-editor-toolbar>.pull-right",function(b){var c=a(this),d=a(b.target);if(!c.parent()[0].hasAttribute("readonly")){d.hasClass("glyphicon")&&(d=d.parent());var e=d.attr("data-type")||"",f=d.attr("data-target")||"",g=d.attr("data-value")||"";if(e&&g&&f){var h=c.find('input[name="'+f+'"]').val(),i=a.Event("change.af.editor.toolbar");"checkbox"===e&&(g=d.find(".glyphicon").hasClass("glyphicon-check")?"":"1"),c.parent().trigger(i,[f,h,g]),i.isDefaultPrevented()||("checkbox"===e?d.find(".glyphicon").addClass("glyphicon-"+("1"===g?"check":"unchecked")).removeClass("glyphicon-"+("1"===g?"unchecked":"check")):(c.find('[data-type="'+e+'"]').each(function(){a(this).find(".glyphicon-check").addClass("glyphicon-unchecked").removeClass("glyphicon-check")}),c.find('[data-type="'+e+'"][data-value="'+g+'"]').find(".glyphicon-unchecked").addClass("glyphicon-check").removeClass("glyphicon-unchecked")),c.find('input[name="'+f+'"]').val(g),c.parent().trigger("changed.af.editor.toolbar",[f,h,g]))}}}).on("keydown",".af-editor-toolbar>.pull-right>span[tabindex=0]",function(b){13!=b.which&&32!=b.which||(b.preventDefault(),a(this).click())}).on("click",".af-statebar-area>.btn-group>button[tabindex=-1]",function(b,c){var f=a(this),g=i.$textarea,h=i.$element.find("iframe"),j=f.attr("data-type");if(f.blur(),"link"==j||"video"==j)return!1;g.is(":visible")&&g.length>0?d(j,null,g):h.length>0&&e(j,null,h)}).on("click",".af-editor-uploaded>.file-item",function(){var b=a(this),c=b.attr("data-srl"),d=a('[name="remove_files[]"][value="'+c+'"]');d.length?(d.remove(),b.css("color","").attr("title",b.attr("title").substr(9))):(a('<input type="hidden" name="remove_files[]" value="'+c+'">').insertAfter(b),b.css("color","hotpink").attr("title","(Remove) "+b.attr("title")))}).on("dragstart",".af-editor-uploaded>.file-item",function(b){var c=a(this);c.data&&c.data("bs.tooltip")&&c.tooltip("hide"),b.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:c.attr("data-type"),srl:c.attr("data-srl"),title:c.attr("data-title")||c.attr("title")}))}).on("dragover",".af-editor-content>textarea",function(a){a.preventDefault()}).on("drop",".af-editor-content>textarea",function(c){c.preventDefault(),b(c,a(this))}).on("insert.af.uploader",".uploader-group",function(b,c){b.preventDefault();var d=a(this).find(".file-caption"),e=a(this).find("input:file")[0].hasAttribute("multiple");d.html(""),a.map(c,function(b,c){var g=b.type.escapeHtml(),h=b.size.shortFileSize(),i=b.name.escapeHtml()+" ("+h+")",j=(window.URL||window.webkitURL).createObjectURL(b),k=a('<i class="file-item" draggable="true" title="'+(e?i:"")+'" data-type="'+g+'" data-index="'+c+'" data-path="'+j+'">');k.text(e?"":i).appendTo(d).on("dragstart",function(b){var c=a(this);c.data&&c.data("bs.tooltip")&&c.tooltip("hide"),b.originalEvent.dataTransfer.setData("TEXT",JSON.stringify({type:c.attr("data-type"),index:c.attr("data-index"),title:e?c.attr("data-title")||c.attr("title"):c.text(),path:c.attr("data-path")}))}),f(k)})}).on("delete.af.uploader",".uploader-group",function(b,c){b.preventDefault();var d=a(this).find(".file-caption"),e=d.closest(".uploader-group");d.find(".file-item").tooltip("destroy").end().text(e.attr("placeholder")||""),e.find("input:file").val("")}),this.$element.find(".form-control-feedback").popover({html:1,trigger:"focus",placement:"top",title:$_LANG.help_editor_attach_title||"<strong>첨부파일 사용법</strong>",content:$_LANG.help_editor_attach_content||"본문에 파일을 보여주려면 아이콘을 잡고 끌어 본문 위로 옮기면 됩니다.<br><br>클릭시엔 삭제 모드가 토글됩니다."}).on("show.bs.popover",function(){a(this).data("bs.popover").tip().css({"max-width":"500px","font-size":"12px"})}),this.$element.find('.af-statebar-area [data-toggle="popover"]').popover({html:1,trigger:"manual",placement:"top",content:'<div class="input-group"><input type="text" class="form-control" style="width:150px"><a href="#" class="btn btn-default input-group-addon">OK</a></div>'}).click(function(){a(this).popover("toggle")}).on("inserted.bs.popover",function(){var b=a(this),c=b.data("bs.popover").tip().find(".popover-content"),f=b.attr("data-type")||"";c.find("input").attr("placeholder","video"==f?"YouTube":"Link"),c.find("a").click(function(){var c=a(this).prev().val()||"",g=i.$textarea,h=i.$element.find("iframe");return g.is(":visible")&&g.length>0?d(f,c,g):h.length>0&&e(f,c,h),b.popover("hide"),!1})}),this.$element.find(".uploader-group .file-item").each(function(){f(a(this))});var j=this.$element.find("iframe");j.length&&j.remove(),this.options.html&&this.switch(!0)}function h(b){return this.each(function(){var c=a(this),d=c.data("af.editor"),e="object"==typeof b&&b;d||c.data("af.editor",d=new g(this,e)),"string"==typeof b&&d[b]()}).data("af.editor")}g.VERSION="1.0.0",g.DEFAULTS={required:!1,readonly:!1,html:!1},g.prototype.switch=function(c){var d=this.$textarea,e=this.$element.find("iframe"),f=d.css("height")||"",g=this.options.readonly;if(c)e.length||(e=a('<iframe class="form-control vresize">').on("load",function(){var c=a(this);c.contents().find("body").on("dragover",function(a){a.preventDefault()}).on("drop",function(a){a.preventDefault(),b(a,c)}),c.contents().find("head").html('<link rel="stylesheet" href="'+request_uri+'module/editor/editor.min.css">'),c.contents().find("body").html(d.val()),g||(c.contents()[0].designMode="on")}).insertAfter(d.hide()).end(),g?e.attr("readonly","readonly"):e.removeAttr("readonly")),e.css("height",f);else{var h;e.length?(f=e.css("height"),h=e.contents().find("body").html(),e.remove()):h=d.val(),d.css("height",f).val(h).show(),g?d.attr("readonly","readonly"):d.removeAttr("readonly")}},g.prototype.toggle=function(){this.switch(this.$textarea.is(":visible"))};var i=a.fn.afEditor;a.fn.afEditor=h,a.fn.afEditor.Constructor=g,a.fn.afEditor.noConflict=function(){return a.fn.afEditor=i,this}}(jQuery);